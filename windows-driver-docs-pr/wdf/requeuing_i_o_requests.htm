<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Requeuing I/O Requests"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Requeuing I/O Requests</title>

<meta name="MS-HAID" content="Ch3_DFIoPackage_d360691b-de31-45f6-b86f-d51011febbb7.xml"/>
<meta name="MS-HAID" content="kmdf.requeuing_i_o_requests"/>
<meta name="MS-HAID" content="wdf.requeuing_i_o_requests"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.requeuing_i_o_requests"></a>Requeuing I/O Requests</h1>
</div>
<h2><a id="ddk_requeuing_i_o_requests_df"></a><a id="DDK_REQUEUING_I_O_REQUESTS_DF"></a></h2>
<p>Drivers can requeue I/O requests that they obtain from an I/O queue. A driver can requeue a I/O request to another I/O queue that the driver has created for the same device. In addition, a <a href="kernel.bus_drivers">bus driver</a> can requeue an I/O request from a child device's I/O queue to a parent device's I/O queue.</p>
<h3><a id="requeuing_an_i_o_request_to_a_different_i_o_queue_for_a_device"></a><a id="REQUEUING_AN_I_O_REQUEST_TO_A_DIFFERENT_I_O_QUEUE_FOR_A_DEVICE"></a>Requeuing an I/O Request to a Different I/O Queue for a Device</h3>
<p>After a driver's request handlers receives an I/O request from a driver's I/O queue, the driver can call <a href="wdf.wdfrequestforwardtoioqueue"><b>WdfRequestForwardToIoQueue</b></a> to requeue the request to another queue. </p>
<p>For example, if you want your driver to allocate resources to a request before processing the request, the driver's <a href="wdf.evtiodefault"><i>EvtIoDefault</i></a> callback function could receive all requests, store resource information in each request's context memory, and then call <a href="wdf.wdfrequestforwardtoioqueue"><b>WdfRequestForwardToIoQueue</b></a> to requeue each request to an additional queue.</p>
<p>If your driver calls <a href="wdf.wdfrequestforwardtoioqueue"><b>WdfRequestForwardToIoQueue</b></a> to requeue an I/O request that the driver obtained from an I/O queue that is using the sequential <a href="dispatching_methods_for_i_o_requests.htm">dispatching method</a>, the framework will deliver the next I/O request from the sequential queue to the driver without waiting for the requeued request to complete. </p>
<p>If your driver is using the manual dispatching method, it can call the <a href="wdf.wdfrequestrequeue"><b>WdfRequestRequeue</b></a> method to return an I/O request to the head of the I/O queue from which the driver obtained it. After calling <b>WdfRequestRequeue</b>, the driver's next call to <a href="wdf.wdfioqueueretrievenextrequest"><b>WdfIoQueueRetrieveNextRequest</b></a> retrieves the requeued request.</p>
<h3><a id="requeuing_an_i_o_request_to_a_parent_device_s_i_o_queue"></a><a id="REQUEUING_AN_I_O_REQUEST_TO_A_PARENT_DEVICE_S_I_O_QUEUE"></a>Requeuing an I/O Request to a Parent Device's I/O Queue</h3>
<p>A function driver for a parent device can act as a <a href="kernel.bus_drivers">bus driver</a> that <a href="enumerating_the_devices_on_a_bus.htm">enumerates</a> the child devices of the parent device and creates <a href="wdm_concepts_for_kmdf_drivers.htm#device_stacks">physical device objects</a> (PDOs) for the child devices. Such drivers can sometimes receive I/O requests for a child device that the parent device must handle. </p>
<p>For example, a protocol bus (such as USB) typically controls the hardware resources that are assigned to each connected device. Therefore, the function driver for the parent bus typically handles I/O operations for each child device. When the I/O manager sends an I/O request to the <a href="wdm_concepts_for_kmdf_drivers.htm#device_stacks">device stack</a> of one of the child devices, the function driver for the bus receives the I/O request in one of the child device's I/O queues, because that driver created the child device's PDO. Before the driver can process the I/O request in the context of the parent bus device, it must requeue the I/O request from the child device's I/O queue to an I/O queue that belongs to the parent device.</p>
<p>However, drivers cannot call <a href="wdf.wdfrequestforwardtoioqueue"><b>WdfRequestForwardToIoQueue</b></a> to move requests from a child's queue to a parent's queue. Because the I/O manager creates separate device stacks for the parent and child devices, the underlying WDM device object must first be changed from one that represents the child device to one that represents the parent.</p>
<p>Prior to version 1.9 of KMDF, drivers could send I/O requests from a child device to its parent only by creating <a href="general_i_o_targets.htm">remote I/O targets</a>, increasing the size of the child device's device stack, and specifying the correct WDM device object. </p>
<p>Beginning with KMDF version 1.9, a driver can call <a href="wdf.wdfpdoinitallowforwardingrequesttoparent"><b>WdfPdoInitAllowForwardingRequestToParent</b></a> before it creates a child device and then call <a href="wdf.wdfrequestforwardtoparentdeviceioqueue"><b>WdfRequestForwardToParentDeviceIoQueue</b></a> to requeue a request from the child's I/O queue to a parent queue. If a driver uses<b>WdfPdoInitAllowForwardingRequestToParent</b> and <b>WdfRequestForwardToParentDeviceIoQueue</b>, the framework increases the child's device stack size and assigns the correct WDM device object to the I/O request. </p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Requeuing I/O Requests%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
