<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Framework Object Context Space"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Framework Object Context Space</title>

<meta name="MS-HAID" content="Ch1_DFPatterns_0f576f71-e53e-4cdf-ae7a-e2a1196aa3a6.xml"/>
<meta name="MS-HAID" content="kmdf.framework_object_context_space"/>
<meta name="MS-HAID" content="wdf.framework_object_context_space"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.framework_object_context_space"></a>Framework Object Context Space</h1>
</div>
<h2><a id="ddk_framework_object_context_df"></a><a id="DDK_FRAMEWORK_OBJECT_CONTEXT_DF"></a></h2>
<p><i>Object context space</i> is extra, nonpageable, memory space that a driver can allocate and assign to an object. Each framework-based driver can create one or more object-specific context spaces for every framework object that the driver receives or creates.</p>
<p>Framework-based drivers should store all object-specific data, either by value or by pointer, within the context space of the object to which the data belongs. </p>
<p>For example, a driver for USB devices might create context space for its framework device objects. In the context space, the driver might store such device-specific information as the device's <a href="buses.usb_device_descriptor"><b>USB_DEVICE_DESCRIPTOR</b></a> and <a href="buses.usb_configuration_descriptor"><b>USB_CONFIGURATION_DESCRIPTOR</b></a> structures, plus a handle to a <a href="framework_object_collections.htm">collection object</a> that represents a device interface's pipes.</p>
<p>The framework does not pass framework objects from one driver to another, so you cannot use an object's context space to pass data between two drivers.</p>
<p>To define an object's context space, you must create one or more structures. Each structure represents a separate context space. Your driver will use each structure member to store a piece of object-specific information. Additionally, your driver must ask the framework to generate an <i>accessor method</i> for each structure. This accessor method accepts an object handle as input and returns the address of the object's context space.</p>
<p>Whenever your driver calls an object creation method, such as <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>, the method optionally allocates context space. All object creation methods accept an optional <a href="wdf.wdf_object_attributes"><b>WDF_OBJECT_ATTRIBUTES</b></a> structure as input. This structure describes the context space that you want the framework to allocate for the object. </p>
<p>To add additional context space to an object after the driver has called the object's creation method, the driver can call the <a href="wdf.wdfobjectallocatecontext"><b>WdfObjectAllocateContext</b></a> method--which, like the object creation methods, accepts a <a href="wdf.wdf_object_attributes"><b>WDF_OBJECT_ATTRIBUTES</b></a> structure as input.</p>
<p>When the framework allocates context space for an object, it also zero-initializes the context space.</p>
<p>When either the framework or a driver deletes a framework object, the framework deletes all of the object's context space. </p>
<p>If your driver uses context space to store pointers to buffers that the driver allocates when it creates an object, the driver should provide an <a href="wdf.evtcleanupcallback"><i>EvtCleanupCallback</i></a> function that deallocates the buffers when the object is deleted.</p>
<p>To define an object's context space structure and accessor method for the objects that your driver creates, your driver must use the following steps:</p>
<ol>
<li>
<p>Define a structure that describes the data that you want to store. For example, if you want to create context data for your driver's device objects, your driver might define a structure called MY_DEVICE_CONTEXT.</p>
</li>
<li>
<p>Use either the <a href="wdf.wdf_declare_context_type"><b>WDF_DECLARE_CONTEXT_TYPE</b></a> macro or the <a href="wdf.wdf_declare_context_type_with_name"><b>WDF_DECLARE_CONTEXT_TYPE_WITH_NAME</b></a> macro. Both of these macros do the following:<ul>
<li>Create and initialize a <a href="wdf.wdf_object_context_type_info"><b>WDF_OBJECT_CONTEXT_TYPE_INFO</b></a> structure. </li>
<li>Define an accessor method that your driver will later use to access an object's context space. The accessor method's return value is a pointer to the object's context space.</li>
</ul>
</p>
<p>The WDF_DECLARE_CONTEXT_TYPE macro creates the accessor method's name from your structure's name. For example, if your context structure's name is MY_DEVICE_CONTEXT, the macro creates an accessor method that is named <b>WdfObjectGet_MY_DEVICE_CONTEXT</b>. </p>
<p>The WDF_DECLARE_CONTEXT_TYPE_WITH_NAME macro lets you specify the accessor method's name. For example, you might specify <b>GetMyDeviceContext</b> as the name for your context accessor method for device objects.</p>
</li>
<li>
<p>Call <a href="wdf.wdf_object_attributes_init"><b>WDF_OBJECT_ATTRIBUTES_INIT</b></a> to initialize the object's <a href="wdf.wdf_object_attributes"><b>WDF_OBJECT_ATTRIBUTES</b></a> structure.</p>
</li>
<li>
<p>Use the <a href="wdf.wdf_object_attributes_set_context_type"><b>WDF_OBJECT_ATTRIBUTES_SET_CONTEXT_TYPE</b></a> macro to set the <b>ContextTypeInfo</b> member of the WDF_OBJECT_ATTRIBUTES structure to the address of the WDF_OBJECT_CONTEXT_TYPE_INFO structure.</p>
</li>
<li>
<p>Call an object creation method, such as <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>. </p>
</li>
</ol>
<p>After your driver has created an object, the driver can call <a href="wdf.wdfobjectallocatecontext"><b>WdfObjectAllocateContext</b></a> at any time to add additional context space to the object.</p>
<p>Because steps 1 and 2 define global data structures and create a driver-callable routine, your driver must complete these steps in an area of the driver that declares global data--typically a header file. These steps must not be completed from within your driver's routines.</p>
<p>Your driver must complete steps 3, 4, and 5 from within a driver routine that creates an object, such as an <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function that calls <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>. </p>
<p>The framework can create two types of objects -- framework request objects and framework file objects -- on behalf of your driver. Your driver can register context space for these objects by calling <a href="wdf.wdfdeviceinitsetrequestattributes"><b>WdfDeviceInitSetRequestAttributes</b></a> and <a href="wdf.wdfdeviceinitsetfileobjectconfig"><b>WdfDeviceInitSetFileObjectConfig</b></a>, respectively. Your driver can also call <a href="wdf.wdfobjectallocatecontext"><b>WdfObjectAllocateContext</b></a> to allocate context space for these objects.</p>
<p>After an object has been created, the driver can obtain a pointer to the object's context space by using either of the following techniques:</p>
<ul>
<li>
<p>Call the context accessor method that you created in step 2 in the preceding procedure by using either the <a href="wdf.wdf_declare_context_type"><b>WDF_DECLARE_CONTEXT_TYPE</b></a> or the <a href="wdf.wdf_declare_context_type_with_name"><b>WDF_DECLARE_CONTEXT_TYPE_WITH_NAME</b></a> macro.</p>
</li>
<li>
<p>Call <a href="wdf.wdfobjectgettypedcontext"><b>WdfObjectGetTypedContext</b></a>, supplying the name of your driver-defined context structure.</p>
</li>
</ul>
<p>If your driver has a context space pointer, it can find the object that the context space belongs to by calling <a href="wdf.wdfobjectcontextgetobject"><b>WdfObjectContextGetObject</b></a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Framework Object Context Space%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
