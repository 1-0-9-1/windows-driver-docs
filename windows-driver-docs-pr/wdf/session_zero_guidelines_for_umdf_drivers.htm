<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Session Zero Guidelines for UMDF Drivers"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Session Zero Guidelines for UMDF Drivers</title>

<meta name="MS-HAID" content="umdf.session_zero_guidelines_for_umdf_drivers"/>
<meta name="MS-HAID" content="wdf.session_zero_guidelines_for_umdf_drivers"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.session_zero_guidelines_for_umdf_drivers"></a>Session Zero Guidelines for UMDF Drivers</h1>
</div>
<p>Starting in  Windows Vista, the operating system isolates services and system processes in Session 0, while applications run in subsequent, higher numbered sessions. Because the UMDF host process (WUDFHost.exe) is one of the system processes that run in session 0, UMDF drivers are isolated from applications. As a result, you must use the following guidelines when developing your driver:</p>
<ul>
<li>
<p>Do not create a user interface (UI) element, such as a dialog box, or depend on user input. Because the user is not running in Session 0, he or she never sees the UI and cannot respond to it.</p>
<p>Similarly, do not manipulate any UI elements. For example, a UMDF driver cannot enumerate windows in the user's session.</p>
</li>
<li>If your driver must communicate with a service, use a client/server mechanism such as remote procedure call (RPC) or named pipes.</li>
<li>
<p>Use caution when calling functions in the Windows API. Some functions may manipulate UI elements or attempt to access named objects in a user's session.  Do not call Windows functions  that you would not call from a user-mode service. As a general rule, a UMDF driver can safely call functions that are exported in kernel32.dll, but not functions exported in user32.dll. 
</p>
<p>A UMDF driver might call Windows functions to perform the following tasks:</p>
<ul>
<li>A driver might call <b>SetupDi</b><i>Xxx</i>
functions to retrieve a Plug and Play device property. For example, the <a href="http://go.microsoft.com/fwlink/p/?linkid=256202">UMDF Sample Driver for OSR USB Fx2 Learning Kit</a> calls <a href="devinst.setupdigetdeviceregistryproperty"><b>SetupDiGetDeviceRegistryProperty</b></a> to retrieve the GUID for the device's bus type.<div class="alert"><b>Note</b>  A UMDF driver cannot safely call many of the <b>SetupDi</b><i>Xxx</i> functions, but it is safe to call functions that retrieve device node properties.</div>
<div> </div>
</li>
<li>A driver that retrieves I/O requests from a manual queue might  create a periodic timer to poll the queue. For example, the <a href="http://go.microsoft.com/fwlink/p/?linkid=256226">WudfVhidmini</a> sample registers a timer callback routine by calling <a href="base.createthreadpooltimer"><b>CreateThreadpoolTimer</b></a>, and then sets a periodic timer by calling <a href="base.setthreadpooltimer"><b>SetThreadpoolTimer</b></a>. <div class="alert"><b>Note</b>  Starting in version 1.11, UMDF provides support for work items.  For more information, see <a href="using_workitems.htm">Using Work Items</a>.</div>
<div> </div>
</li>
</ul>
</li>
</ul>
<p>For additional information about using system services outside the frameworks, see Chapter 14 ("Beyond the Frameworks") of Orwick, Penny, and Guy Smith. <i>Developing Drivers with the Windows Driver Foundation</i>. Redmond, WA: Microsoft Press, 2007.</p>
<p>For additional information about session zero isolation, see <a href="http://go.microsoft.com/fwlink/p/?linkid=240132">Impact of Session 0 Isolation on Services and Drivers in Windows</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Session Zero Guidelines for UMDF Drivers%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
