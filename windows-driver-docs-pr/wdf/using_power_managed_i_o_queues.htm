<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Using Power-Managed I/O Queues"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Using Power-Managed I/O Queues</title>

<meta name="MS-HAID" content="Ch3_DFIoPackage_fcee6be3-24e0-4332-83fa-38a92d558cdb.xml"/>
<meta name="MS-HAID" content="kmdf.using_power_managed_i_o_queues"/>
<meta name="MS-HAID" content="wdf.using_power_managed_i_o_queues"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.using_power_managed_i_o_queues"></a>Using Power-Managed I/O Queues</h1>
</div>
<p>When a driver creates an I/O queue, it can specify whether the queue is <i>power-managed</i>. When I/O requests are available in a power-managed queue, the framework delivers the requests to the driver only if the device is in its working (D0) state.  The framework does not allow the device to leave its working state until all I/O requests that the framework has delivered from the power-managed queue to the driver have been completed, canceled, or postponed.</p>
<p>For more information about power-managed I/O queues, see <a href="power_management_for_i_o_queues.htm">Power Management for I/O Queues</a>.</p>
<h2><a id="Callback_functions_for_Power-Managed_Queues"></a><a id="callback_functions_for_power-managed_queues"></a><a id="CALLBACK_FUNCTIONS_FOR_POWER-MANAGED_QUEUES"></a>Callback functions for Power-Managed Queues</h2>
<p>If your driver uses power-managed I/O queues, it can provide two additional callback functions:</p>
<p></p>
<dl>
<dt><a id="_________EvtIoStop"></a><a id="_________evtiostop"></a><a id="_________EVTIOSTOP"></a><a href="wdf.evtiostop"><i>
        EvtIoStop</i></a></dt>
<dd>
<p>The <a href="wdf.evtiostop"><i>EvtIoStop</i></a> callback function stops processing a specified I/O request. When the device leaves its working (D0) state or is removed, the framework calls an I/O queue's <i>EvtIoStop</i> callback function once for every I/O request that the driver has not <a href="completing_i_o_requests.htm">completed</a>, including requests that the driver <a href="request_ownership.htm">owns</a> and those that it has <a href="forwarding_i_o_requests.htm">forwarded</a> to an I/O target.</p>
</dd>
<dt><a id="_________EvtIoResume"></a><a id="_________evtioresume"></a><a id="_________EVTIORESUME"></a><a href="wdf.evtioresume"><i>
        EvtIoResume</i></a></dt>
<dd>
<p>The <a href="wdf.evtioresume"><i>EvtIoResume</i></a> callback function resumes processing a previously stopped I/O request. The framework calls an I/O queue's <i>EvtIoResume</i> callback function when it resumes delivering I/O requests to the driver from the queue, after the device has returned to its working state. </p>
</dd>
</dl>
<p>Each time the framework calls a driver's <a href="wdf.evtiostop"><i>EvtIoStop</i></a> callback function, the function typically  <a href="completing_i_o_requests.htm">completes</a> or <a href="canceling_i_o_requests.htm">cancels</a> the I/O request, or calls <a href="wdf.wdfrequeststopacknowledge"><b>WdfRequestStopAcknowledge</b></a> to return ownership of the request to the framework.</p>
<p>While doing so is optional, you should in general provide an <a href="wdf.evtiostop"><i>EvtIoStop</i></a> callback function for a power-managed queue.  By providing <i>EvtIoStop</i>, your driver can help to shorten the time that elapses before your device, and possibly the system, enters a low-power state.</p>
<p> If you do not provide <a href="wdf.evtiostop"><i>EvtIoStop</i></a> for a power-managed queue, the framework waits until all requests delivered from the power-managed queue to the driver are complete before moving the device (or system) to a lower power state or removing the device. Potentially, this inaction can prevent a system from entering its hibernation state or another low system power state. In extreme cases, it can cause the system to crash with bugcheck code 9F.</p>
<p>If your driver does not forward requests to an I/O target and does not hold requests for an indeterminate time, you could safely omit <a href="wdf.evtiostop"><i>EvtIoStop</i></a> for a power-managed queue.</p>
<h2><a id="Waiting_for_Dispatcher_Objects"></a><a id="waiting_for_dispatcher_objects"></a><a id="WAITING_FOR_DISPATCHER_OBJECTS"></a>Waiting for Dispatcher Objects</h2>
<p>In general, drivers should only use dispatcher objects as synchronization mechanisms within a nonarbitrary thread context.</p>
<p>Because <a href="request_handlers.htm">request handlers</a> run in an arbitrary thread context, a request handler for a power-managed queue must not wait for kernel dispatcher objects to be set. Doing so may result in deadlock. </p>
<p> For more information about when a driver can wait for dispatcher objects, and what to do when it can't,  see <a href="kernel.introduction_to_kernel_dispatcher_objects">Introduction to Kernel Dispatcher Objects</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Using Power-Managed I/O Queues%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
