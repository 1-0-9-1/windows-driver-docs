<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="This topic describes how to select a target operating system and framework version for a driver project in Visual Studio. It also describes the co-installer and how to determine if you should include this component in your driver package."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Building and Loading a WDF Driver</title>

<meta name="MS-HAID" content="Ch0_DFArchOverview_8c50d087-f145-4c25-8fdb-19f778380855.xml"/>
<meta name="MS-HAID" content="kmdf.building_and_loading_a_framework_based_driver"/>
<meta name="MS-HAID" content="kmdf.building_and_loading_a_kmdf_driver"/>
<meta name="MS-HAID" content="umdf.building_umdf_drivers"/>
<meta name="MS-HAID" content="wdf.building_and_loading_a_kmdf_driver"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.building_and_loading_a_kmdf_driver"></a>Building and Loading a WDF Driver</h1>
</div>
<p>  This topic describes how to select a target operating system and framework version for a driver project in Visual Studio. It also describes the co-installer and how to determine if you should include this component in your driver package.</p>
<h2><a id="Which_framework_version_should_I_use_"></a><a id="which_framework_version_should_i_use_"></a><a id="WHICH_FRAMEWORK_VERSION_SHOULD_I_USE_"></a>Which framework version should I use?</h2>
<p>If your driver needs to run only on Windows 8.1, use Kernel-Mode Driver Framework (KMDF) version 1.13 or User-Mode Driver Framework (UMDF) version 2.0.</p>
<p>If your driver must work on operating systems earlier than Windows 8.1, we recommend that you use KMDF or UMDF version 1.11.</p>
<p>You can use the Windows Driver Kit (WDK) that ships with Windows 8.1 to build KMDF 1.9, 1.11, and 1.13 drivers, as well as UMDF 1.9, 1.11, and 2.0 drivers.</p>
<h2><a id="How_do_I_set_the_versions_in_Visual_Studio_"></a><a id="how_do_i_set_the_versions_in_visual_studio_"></a><a id="HOW_DO_I_SET_THE_VERSIONS_IN_VISUAL_STUDIO_"></a>How do I set the versions in Visual Studio?</h2>
<p>If you're building your driver project for the latest version of Windows and the most recent KMDF or UMDF version, you can keep the defaults and skip this step.</p>
<p>Otherwise, follow these steps:</p>
<ul>
<li>Change the <b>Project Configuration</b> setting in the <b>Configuration Manager</b> to an appropriate value (such as <b>Win7 Debug</b>).</li>
<li>Change the KMDF_VERSION_MINOR or UMDF_VERSION_MINOR value in the <a href="https://msdn.microsoft.com/windows-drivers/develop/driver_model_settings_properties_for_driver_projects">Driver Model Settings</a> to an appropriate value (such as 11).</li>
</ul>
<p>For detailed information about KMDF and UMDF versions, see <a href="kmdf_version_history.htm">KMDF Version History</a> and <a href="umdf_version_history.htm">UMDF Version History</a>.</p>
<h2><a id="When_do_I_need_to_include_a_co-installer_or_.msu_in_my_driver_package_"></a><a id="when_do_i_need_to_include_a_co-installer_or_.msu_in_my_driver_package_"></a><a id="WHEN_DO_I_NEED_TO_INCLUDE_A_CO-INSTALLER_OR_.MSU_IN_MY_DRIVER_PACKAGE_"></a>When do I need to include a co-installer or .msu in my driver package?</h2>
<p>If you build a driver for Windows 8.1 using KMDF 1.13 or UMDF 2.0, you do not need to include a co-installer, custom installer, or reference in the INF file.</p>
<p>If your driver must work on operating systems earlier than Windows 8.1, we recommend that you use KMDF or UMDF version 1.11, and that you include Microsoft-supplied framework updates in your driver package.</p>
<p>The framework updates make it possible to run a driver built with a later framework version than the one included in an operating system. For example, KMDF 1.11 is included in Windows 8. But you can run a KMDF 1.11 driver on Windows Vista or Windows 7.  Before you can do so, however, you must ensure that the KMDF 1.11 framework library replaces the framework library included in the earlier operating system (in this case, KMDF 1.7 and KMDF 1.9 respectively). You do this by redistributing a Microsoft-supplied co-installer or .msu file with your driver package.</p>
<h2><a id="Linking_and_loading"></a><a id="linking_and_loading"></a><a id="LINKING_AND_LOADING"></a>Linking and loading</h2>
<p>When you build a Windows Driver Frameworks (WDF) project in Microsoft Visual Studio, MSBuild links your driver to the appropriate framework library, the library's loader, and a stub file, all of which are included in the WDK. (The library and loader are also included in the framework's <a href="installing_the_framework_s_co_installer.htm">co-installer</a> so that if necessary, you can distribute them with your driver package.) </p>
<p>The stub file contains a special entry point routine: <b>FxDriverEntry</b>. MSBuild sets the stub's <b>FxDriverEntry</b> routine as the initial entry point for framework-based drivers.</p>
<p>When the operating system loads a framework-based driver, it also loads the stub file and the library's loader. Next, the system calls the stub file's <b>FxDriverEntry</b> routine. This routine then calls the loader. The loader determines the version of the framework library that the driver requires and then loads the correct <a href="framework_library_versioning.htm">version of the library</a> as a kernel-mode service (if it is not already loaded). Finally, the library calls the driver's <a href="wdf.driverentry_for_kmdf_drivers"><b>DriverEntry</b></a> routine.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Building and Loading a WDF Driver%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
