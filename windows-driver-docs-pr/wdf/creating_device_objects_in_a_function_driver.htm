<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Creating Device Objects in a Function Driver"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Creating Device Objects in a Function Driver</title>

<meta name="MS-HAID" content="Ch4_DFPnPPackage_1a7f2eb9-aa9d-4452-8d4b-c1ad2fe01724.xml"/>
<meta name="MS-HAID" content="kmdf.creating_device_objects_in_a_function_driver"/>
<meta name="MS-HAID" content="wdf.creating_device_objects_in_a_function_driver"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.creating_device_objects_in_a_function_driver"></a>Creating Device Objects in a Function Driver</h1>
</div>
<p>Each <a href="kernel.function_drivers">function driver</a> creates a framework device object for each of its supported devices that exists on the system. Because these device objects are created by function drivers, they are called functional device objects (FDOs). Each FDO is a function driver's representation of a device. </p>
<p>A function driver must create a framework device object each time the framework calls the driver's <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function. The framework calls this callback function to inform the driver that one of its supported devices exists on the system.</p>
<p>The driver's <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function receives a pointer to a <a href="wdf.wdfdevice_init"><b>WDFDEVICE_INIT</b></a> structure. The driver can call a set of <a href="wdf.wdf_device_object_reference#device_init_methods#device_init_methods">framework device object initialization methods</a>, which store information in the WDFDEVICE_INIT structure. Additionally, function drivers can call <a href="wdf.wdf_device_object_reference#fdo_init_methods#fdo_init_methods">framework FDO initialization methods</a>.</p>
<p>Creating a framework device object in a function driver typically includes the following steps:</p>
<ul>
<li>
<p>Registering PnP, power, and power policy callback functions.</p>
<p>Most function drivers call <a href="wdf.wdfdeviceinitsetpnppowereventcallbacks"><b>WdfDeviceInitSetPnpPowerEventCallbacks</b></a> to register PnP and power callback functions. For more information about these callback functions, see <a href="supporting_pnp_and_power_management_in_function_drivers.htm">Supporting PnP and Power Management in Function Drivers</a>.</p>
<p>If the device supports low-power idle or has wake-up capabilities, the function driver typically also calls <a href="wdf.wdfdeviceinitsetpowerpolicyeventcallbacks"><b>WdfDeviceInitSetPowerPolicyEventCallbacks</b></a> to register power policy callback functions. For more information about these callback functions, see <a href="power_policy_ownership.htm">Power Policy Ownership</a>.</p>
</li>
<li>
<p>Registering function driver-specific callback functions.</p>
<p>Some function drivers call <a href="wdf.wdffdoinitseteventcallbacks"><b>WdfFdoInitSetEventCallbacks</b></a>, if they must participate in specifying the system hardware resources that a device requires. For more information about hardware resources, see <a href="hardware_resources_for_kmdf_drivers.htm">Hardware Resources for Framework-Based Drivers</a>. </p>
</li>
<li>
<p>Registering file event callback functions.</p>
<p>If your driver must respond when an application opens or closes a file on a device, the driver must call <a href="wdf.wdfdeviceinitsetfileobjectconfig"><b>WdfDeviceInitSetFileObjectConfig</b></a> to register callback functions for the framework file object. For more information, see <a href="framework_file_objects.htm">Using Framework File Objects</a>.</p>
</li>
<li>
<p>Setting I/O request attributes.</p>
<p>If your driver will receive I/O requests from framework queue objects, the driver can call <a href="wdf.wdfdeviceinitsetrequestattributes"><b>WdfDeviceInitSetRequestAttributes</b></a> to set up context memory that the framework will assign to a device's request objects. For more information, see <a href="using_request_object_context.htm">Using Request Object Context</a>.</p>
</li>
<li>
<p>Setting device characteristics.</p>
<p>Typically, a function driver calls some of the following methods to specify a device's characteristics:</p>
<dl>
<dd><a href="wdf.wdfdeviceinitsetdevicetype"><b>WdfDeviceInitSetDeviceType</b></a>, to identify the type of hardware that the driver supports.</dd>
<dd><a href="wdf.wdfdeviceinitsetiotype"><b>WdfDeviceInitSetIoType</b></a>, to identify a method for accessing data buffers, if the driver handles I/O requests from applications.</dd>
<dd><a href="wdf.wdfdeviceinitsetcharacteristics"><b>WdfDeviceInitSetCharacteristics</b></a>, to set device characteristics, such as whether the device is read-only or supports removable media.</dd>
<dd><a href="wdf.wdfdeviceinitsetexclusive"><b>WdfDeviceInitSetExclusive</b></a>, if the device requires exclusive access by one application at a time. </dd>
<dd><a href="wdf.wdfdeviceinitsetpowerinrush"><b>WdfDeviceInitSetPowerInrush</b></a>, if the device requires an inrush of current when it transitions from a low-power state to its working (D0) state.</dd>
<dd><a href="wdf.wdfdeviceinitsetpowerpageable"><b>WdfDeviceInitSetPowerPageable</b></a> or <a href="wdf.wdfdeviceinitsetpowernotpageable"><b>WdfDeviceInitSetPowerNotPageable</b></a>, to indicate whether the driver must access pageable data while the system is transitioning between a sleeping state and the working (S0) state.</dd>
<dd><a href="wdf.wdfdeviceinitassignname"><b>WdfDeviceInitAssignName</b></a>, to assign a name to the device object.</dd>
<dd><a href="wdf.wdfdeviceinitassignsddlstring"><b>WdfDeviceInitAssignSDDLString</b></a>, to assign a security descriptor to the device object.</dd>
<dd><a href="wdf.wdfdeviceinitsetdeviceclass"><b>WdfDeviceInitSetDeviceClass</b></a>, to identify the device's setup class.</dd>
</dl>
</li>
<li>
<p>Obtaining device properties.</p>
<p>Sometimes function drivers must obtain information about the device properties that the driver for the device's bus, or other lower-level driver, has set. The driver can call <a href="wdf.wdffdoinitqueryproperty"><b>WdfFdoInitQueryProperty</b></a> or <a href="wdf.wdffdoinitallocandqueryproperty"><b>WdfFdoInitAllocAndQueryProperty</b></a> to obtain this information.  New drivers targeting Windows 8.1 and later can call  <a href="wdf.wdffdoinitquerypropertyex"><b>WdfFdoInitQueryPropertyEx</b></a> and <a href="wdf.wdffdoinitallocandquerypropertyex"><b>WdfFdoInitAllocAndQueryPropertyEx</b></a>.</p>
</li>
<li>
<p>Accessing the device's registry key.</p>
<p>Some function drivers must obtain information about the device or driver that another driver, a user, or an installation package has placed in the registry. The driver can call <a href="wdf.wdffdoinitopenregistrykey"><b>WdfFdoInitOpenRegistryKey</b></a> to open the device or driver's registry key. For more information, see <a href="wdf.using_the_registry_in_kmdf_drivers">Using the Registry in Framework-Based Drivers</a>. </p>
</li>
<li>
<p>Creating a default child list configuration to use for dynamic enumeration.</p>
<p>If you are writing a function driver for a bus, and if your driver will perform dynamic enumeration of child devices that are connected to the bus, the driver must call <a href="wdf.wdffdoinitsetdefaultchildlistconfig"><b>WdfFdoInitSetDefaultChildListConfig</b></a>. For more information, see <a href="enumerating_the_devices_on_a_bus.htm">Enumerating the Devices on a Bus</a>.</p>
</li>
<li>
<p>Creating the device object.</p>
<p>The final step in creating a device object is to call <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>. </p>
</li>
</ul>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Creating Device Objects in a Function Driver%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
