<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Supporting Idle Power-Down in UMDF Drivers"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Supporting Idle Power-Down in UMDF Drivers</title>

<meta name="MS-HAID" content="umdfobjectdg_b6bcc0ba-ba53-4d9c-a38f-3d70dcd83869.xml"/>
<meta name="MS-HAID" content="umdf.supporting_idle_power_down_in_umdf_based_drivers"/>
<meta name="MS-HAID" content="umdf.supporting_idle_power_down_in_umdf_drivers"/>
<meta name="MS-HAID" content="wdf.supporting_idle_power_down_in_umdf_drivers"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.supporting_idle_power_down_in_umdf_drivers"></a>Supporting Idle Power-Down in UMDF Drivers</h1>
</div>
<p class="CCE_Message">[This topic applies to UMDF 1.<i>x</i>.]</p>
<p>Some devices can enter a sleeping state while the system remains in its working state. For such devices, the framework initiates lowering the device's power after the device has been idle (not used) for a predetermined (and settable) amount of time.</p>
<p>Some of these devices can also trigger a wake-up signal on the bus when they detect an external event. The bus driver responds to this signal, and the driver stack restores the device to its working state. (Devices that do not detect external events remain in a low-power state until the framework asks the bus driver to initiate restoring the device to its working state.) </p>
<p>If your device can be powered down when it is idle, the <a href="power_policy_ownership_in_umdf.htm">power policy owner</a> must perform the following two steps:</p>
<ol>
<li>Call <a href="wdf.iwdfdevice2_assigns0idlesettings"><b>IWDFDevice2::AssignS0IdleSettings</b></a> or <a href="wdf.iwdfdevice3_assigns0idlesettingsex"><b>IWDFDevice3::AssignS0IdleSettingsEx</b></a> to specify:<ul>
<li>The low-power state that the device will enter </li>
<li>The amount of time that the device must remain idle before its power state is lowered</li>
<li>Whether the device can detect an external event and trigger a wake-up signal on the bus</li>
<li>Whether users can control the device's idle settings</li>
<li>Whether the framework can put the device in the D3cold power state when the idle timeout period expires</li>
</ul>If your driver was built with version 1.11 or later of the framework, you can call <b>IWDFDevice3::AssignS0IdleSettingsEx</b> instead of <b>IWDFDevice2::AssignS0IdleSettings</b>.  In addition to the above functionality, <b>IWDFDevice3::AssignS0IdleSettingsEx</b> allows the driver to specify:<ul>
<li>Whether the device's idle power-down capability is enabled or disabled</li>
<li>Whether the device will return to its working (D0) state when the system returns to its working (S0) state</li>
</ul>
</li>
<li>Implement the <a href="wdf.ipowerpolicycallbackwakefroms0">IPowerPolicyCallbackWakeFromS0</a> interface and the following event callback functions, if you need them for your device:<ul>
<li><a href="wdf.ipowerpolicycallbackwakefroms0_onarmwakefroms0"><b>IPowerPolicyCallbackWakeFromS0::OnArmWakeFromS0</b></a>, which enables the device hardware (not the bus) to respond to an external wake-up event.</li>
<li><a href="wdf.ipowerpolicycallbackwakefroms0_ondisarmwakefroms0"><b>IPowerPolicyCallbackWakeFromS0::OnDisarmWakeFromS0</b></a>, which disables the device's ability (not the bus's ability) to respond to an external wake-up event.</li>
<li><a href="wdf.ipowerpolicycallbackwakefroms0_onwakefroms0triggered"><b>IPowerPolicyCallbackWakeFromS0::OnWakeFromS0Triggered</b></a>, which informs the driver that the bus detected a wake signal.</li>
</ul>
</li>
</ol>
<h2><a id="idle_conditions_umdf"></a><a id="IDLE_CONDITIONS_UMDF"></a></h2>
<p>The framework considers the device to be idle, and starts counting idle time, when all of the following conditions are met:</p>
<ul>
<li>None of the power-managed queues created for this device instance have any requests waiting in queue or dispatched to the driver. If a request was dispatched to the driver and the driver sent it to an I/O target, the request is still related to the queue and the device will not be considered idle.  Requests in non-power–managed queues are not counted toward device idle.</li>
<li>If the driver previously called <a href="wdf.iwdfdevice2_stopidle"><b>IWDFDevice2::StopIdle</b></a>, the driver  has subsequently called <a href="wdf.iwdfdevice2_resumeidle"><b>IWDFDevice2::ResumeIdle</b></a>.</li>
<li>If the power policy owner is a bus driver, none of the child devices of the bus driver are in D0.</li>
</ul>
<p>If your driver (or a user) enables idle power-down for your device, you might have to use the <a href="wdf.iwdfdevice2_stopidle"><b>IWDFDevice2::StopIdle</b></a> method. If the device is in its working (D0) state, this method prevents the device from idling until the driver calls <a href="wdf.iwdfdevice2_resumeidle"><b>IWDFDevice2::ResumeIdle</b></a>. If the device is in a low-power state when the driver calls <b>IWDFDevice2::StopIdle</b>, and if the system is in its working (S0) state, the framework requests the bus driver to restore the device to its working (D0) state. For more information about when your driver might have to call <b>IWDFDevice2::StopIdle</b>, see the method's reference page.</p>
<p>If the device can wake itself from a low-power state, the driver for the device's bus participates in waking the device. The kernel-mode bus driver does whatever is necessary on the bus adapter to enable and disable a device's ability to wake from a low-power state.</p>
<p>For information about registry entries that control a device's idle capabilities, see <a href="user_control_of_device_idle_and_wake_behavior_in_umdf.htm">User Control of Device Idle and Wake Behavior in UMDF</a>. </p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Supporting Idle Power-Down in UMDF Drivers%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
