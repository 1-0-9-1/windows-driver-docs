<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Preventing an Imbalance of Create and Close Notifications to a Driver"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Preventing an Imbalance of Create and Close Notifications to a Driver</title>

<meta name="MS-HAID" content="umdfobjectdg_d53ae75a-f25c-4bd1-b027-8b70008d3cdd.xml"/>
<meta name="MS-HAID" content="umdf.preventing_an_imbalance_of_create_and_close_notifications_to_a_driver"/>
<meta name="MS-HAID" content="wdf.preventing_an_imbalance_of_create_and_close_notifications_to_a_driver"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.preventing_an_imbalance_of_create_and_close_notifications_to_a_driver"></a>Preventing an Imbalance of Create and Close Notifications to a Driver</h1>
</div>
<p class="CCE_Message">[This topic applies to UMDF 1.<i>x</i>.]</p>
<p>An upper UMDF driver can use the <a href="wdf.iwdfdeviceinitialize_autoforwardcreatecleanupclose"><b>IWDFDeviceInitialize::AutoForwardCreateCleanupClose</b></a> method to control when the framework automatically forwards create-file, cleanup-file, and close-file notifications to the next lower driver in the device stack. However, because the upper driver sets <b>AutoForwardCreateCleanupClose</b> to automatically forward only on a device level and not on a per-file level, forwarding must be the same for all files for a device. The framework ensures this forwarding behavior for cleanup-file and close-file notifications. If the upper driver implements the <a href="wdf.iqueuecallbackcreate_oncreatefile"><b>IQueueCallbackCreate::OnCreateFile</b></a> callback function, it must ensure that its forwarding behavior is the same for all create-file requests and is consistent with the forwarding behavior for cleanup-file and close-file notifications. Failing to do so might cause lower drivers to receive an unequal amount of calls to their <b>IQueueCallbackCreate::OnCreateFile</b> method and <a href="wdf.ifilecallbackcleanup_oncleanupfile"><b>IFileCallbackCleanup::OnCleanupFile</b></a> and <a href="wdf.ifilecallbackclose_onclosefile"><b>IFileCallbackClose::OnCloseFile</b></a> methods.</p>
<p>To prevent lower drivers from receiving an unequal amount of create-file and close-file notifications, the upper driver must ensure, in its <a href="wdf.iqueuecallbackcreate_oncreatefile"><b>IQueueCallbackCreate::OnCreateFile</b></a> callback function, that:  </p>
<ul>
<li>
<p>Its forwarding behavior is the same for all files for a device.</p>
</li>
<li>Its forwarding behavior is consistent with how it set the flag parameter of <a href="wdf.iwdfdeviceinitialize_autoforwardcreatecleanupclose"><b>IWDFDeviceInitialize::AutoForwardCreateCleanupClose</b></a>. That is:<ul>
<li>If the driver set the flag to <b>WdfTrue</b>, the driver must forward all the create-file requests down the device stack.</li>
<li>If the driver set the flag to <b>WdfFalse</b>, the driver must not forward any of the create-file requests down the stack.</li>
<li>If the driver set the flag to <b>WdfUseDefault</b> and:<ul>
<li>If the driver is a function driver, it must not forward any create-file requests down the stack.</li>
<li>If the driver is a filter driver, it must forward all create-file requests down the stack.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In situations where the driver cannot forward a create-file request, the driver can still generate a new create-file request for lower drivers by calling the <a href="wdf.iwdfdevice_createwdffile"><b>IWDFDevice::CreateWdfFile</b></a> method to create a new WDF file. The driver can then complete the original create-file request based on the results of the newly generated create-file request (that is, from the results of <b>CreateWdfFile</b>).</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Preventing an Imbalance of Create and Close Notifications to a Driver%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
