<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="This topic describes how you can use the Wudfext.dll debugger extensions in conjunction with a User-Mode Driver Framework (UMDF) version 1 or 2 driver to determine why UMDF indicates that there are outstanding files when you remove a device."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Determining Why UMDF Indicates Outstanding Files at Device Removal Time</title>

<meta name="MS-HAID" content="umdfobjectdg_8881bb03-c415-460d-b9d7-ae70696dfa82.xml"/>
<meta name="MS-HAID" content="umdf.determining_why_umdf_indicates_outstanding_files_at_device_removal_tim"/>
<meta name="MS-HAID" content="wdf.determining_why_umdf_indicates_outstanding_files_at_device_removal_tim"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.determining_why_umdf_indicates_outstanding_files_at_device_removal_tim"></a>Determining Why UMDF Indicates Outstanding Files at Device Removal Time</h1>
</div>
<p>This topic describes how you can use the Wudfext.dll debugger extensions in conjunction with a User-Mode Driver Framework (UMDF) version 1 or 2 driver to determine why UMDF indicates that there are outstanding files when you remove a device.</p>
<p>For UMDF version 1, you'll use extension commands implemented in wudfext.dll. Starting in UMDF version 2, you'll use extension commands implemented in wdfkd.dll.</p>
<p>To determine why UMDF indicates outstanding files, use the following steps:</p>
<ol>
<li>
<p>Use <a href="debugger._wudfext_umdevstack"><b>!wudfext.umdevstack</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfumdevstack"><b>!wdfkd.wdfumdevstack</b></a> (UMDF 2) to dump the device stack. The dump includes outstanding UMDF intra-stack files (that is, file objects that a driver in the stack created as opposed to file objects that were created by an application or by a driver in another stack).</p>
</li>
<li>
<p>For each intra-stack file, run <a href="debugger._wudfext_umfile"><b>!wudfext.umfile</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfumfile"><b>!wdfkd.wdfumfile</b></a> (UMDF 2) to obtain information about the file.</p>
<p>The output includes the list of IRPs that are pending.</p>
</li>
<li>
<p>Determine why each IRP is outstanding by using <a href="debugger._wudfext_umirp"><b>!wudfext.umirp</b></a> (UMDF 1) or  <a href="debugger._wdfkd_wdfumirp"><b>!wdfkd.wdfumirp</b></a> (UMDF 2) to obtain information about the IRP. </p>
<p>From the output of each <a href="debugger._wudfext_umirp"><b>!wudfext.umirp</b></a> or <a href="debugger._wdfkd_wdfumirp"><b>!wdfkd.wdfumirp</b></a>:</p>
<ul>
<li>Determine if the IRP completed.</li>
<li>Determine if a driver-created request was not deleted either explicitly by the driver or implicitly by the object tree.</li>
</ul>
</li>
</ol>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Determining Why UMDF Indicates Outstanding Files at Device Removal Time%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
