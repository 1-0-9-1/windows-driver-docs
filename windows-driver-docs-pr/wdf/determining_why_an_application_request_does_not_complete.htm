<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="This topic describes how you can use the Wudfext.dll debugger extensions in conjunction with a User-Mode Driver Framework (UMDF) version 1 or 2 driver to determine why an application request does not complete."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Determining Why an Application Request Does Not Complete</title>

<meta name="MS-HAID" content="umdfobjectdg_c9ef973d-168d-4161-bf84-817b1ce7a610.xml"/>
<meta name="MS-HAID" content="umdf.determining_why_an_application_request_does_not_complete"/>
<meta name="MS-HAID" content="wdf.determining_why_an_application_request_does_not_complete"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.determining_why_an_application_request_does_not_complete"></a>Determining Why an Application Request Does Not Complete</h1>
</div>
<p>This topic describes how you can use the Wudfext.dll debugger extensions in conjunction with a User-Mode Driver Framework (UMDF) version 1 or 2 driver to determine why an application request does not complete.</p>
<p>For UMDF version 1, you'll use extension commands implemented in wudfext.dll. Starting in UMDF version 2, you'll use extension commands implemented in wdfkd.dll.</p>
<p>You can perform the following steps to determine why an application request does not complete:</p>
<ol>
<li>
<p>Use <a href="debugger._wudfext_umirps"><b>!wudfext.umirps</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfumirps"><b>!wdfkd.wdfumirps</b></a> (UMDF 2) to display all the outstanding user-mode I/O request packets (IRPs) in the host process. The information for each user-mode IRP includes the original kernel-mode IRP for which the user-mode IRP was created. </p>
<p>Determine the user-mode IRP that corresponds to the kernel-mode IRP that the application originated.</p>
</li>
<li>
<p>Use <a href="debugger._wudfext_umirp"><b>!wudfext.umirp</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfumirp"><b>!wdfkd.wdfumirp</b></a> (UMDF 2) to obtain information about a particular user-mode IRP.</p>
<p>The information for the user-mode IRP includes the stack locations. If you know the stack locations, you can determine where the IRP is being processed. Stack location 0 represents the stack below UMDF (that is, the kernel-mode stack or some other sub-system, such as Microsoft Win32 or Winsock).</p>
</li>
<li>If the IRP is at your driver's layer (that is, the layer in which your driver processes the IRP), perform the following steps:<ol>
<li>
<p>View the I/O queues that are set up at your driver's layer. You can use <a href="debugger._wudfext_wudfdevicequeues"><b>!wudfext.wudfdevicequeues</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfdevicequeues"><b>!wdfkd.wdfdevicequeues</b></a> (UMDF 2) to view all the I/O queues that are set up at your driver's layer. You can also use <a href="debugger._wudfext_wudfqueue"><b>!wudfext.wudfqueue</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfqueue"><b>!wdfkd.wdfqueue</b></a> (UMDF 2) to obtain information about a particular queue.</p>
</li>
<li>If there are multiple requests outstanding, you can use <a href="debugger._wudfext_wudfrequest"><b>!wudfext.wudfrequest</b></a> (UMDF 1) or  <a href="debugger._wdfkd_wdfrequest"><b>!wdfkd.wdfrequest</b></a> (UMDF 2) to obtain information about a request, which includes the underlying user-mode IRP. From the user-mode IRP information, you can determine the request that you are interested in. </li>
<li>Verify whether the request is owned by a queue or by the driver. This information is displayed as part of the output from <a href="debugger._wudfext_wudfqueue"><b>!wudfext.wudfqueue</b></a> or <a href="debugger._wdfkd_wdfqueue"><b>!wdfkd.wdfqueue</b></a>. Perform one of the following verifications depending on whether the queue or the driver owns the request:<ul>
<li>If the request is owned by the queue, check the state of the queue to determine why the queue did not deliver the request to the driver. </li>
<li>If the request is owned by the driver, check the threads in the host process to determine if a thread became stuck or deadlocked while processing the request.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>If the IRP is at another UMDF driver layer, you can repeat the preceding steps for that layer. Remember that you can use  <a href="debugger._wudfext_umdevstack"><b>!wudfext.umdevstack</b></a> (UMDF 1) or <a href="debugger._wdfkd_wdfumdevstack"><b>!wdfkd.wdfumdevstack</b></a> (UMDF 2) to view information about all stack layers.</p>
</li>
<li>
<p>If the IRP is beyond the UMDF stack (for example, if stack location 0 is where the IRP is currently being processed), determine why the corresponding kernel-mode IRP did not complete. </p>
</li>
</ol>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Determining Why an Application Request Does Not Complete%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
