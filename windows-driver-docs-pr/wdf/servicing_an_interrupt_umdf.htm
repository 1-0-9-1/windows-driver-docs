<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Servicing an Interrupt"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Servicing an Interrupt</title>

<meta name="MS-HAID" content="umdf.servicing_an_interrupt"/>
<meta name="MS-HAID" content="wdf.servicing_an_interrupt_umdf"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.servicing_an_interrupt_umdf"></a>Servicing an Interrupt</h1>
</div>
<p class="CCE_Message">[This topic applies to UMDF 1.<i>x</i>.]</p>
<p>Servicing an interrupt consists of two steps:</p>
<ol>
<li>Saving volatile information (such as register contents) quickly, in an interrupt service routine.</li>
<li>Processing the saved volatile information in a workitem routine.</li>
</ol>
<p>When a device generates a hardware interrupt, the framework calls the driver's interrupt service routine (ISR), which framework-based drivers implement as an <a href="wdf.oninterruptisr"><i>OnInterruptIsr</i></a> callback function. 
</p>
<p>The <a href="wdf.oninterruptisr"><i>OnInterruptIsr</i></a> callback function, which runs at PASSIVE_LEVEL, must quickly save interrupt information, such as register contents, queue a workitem to process the data further, and return from the ISR to allow servicing of other interrupts if the interrupt line is shared. Because the UMDF driver's ISR runs at PASSIVE_LEVEL, handling PCI line-based interrupts is not recommended. These interrupts are typically shared between multiple devices, some of which might not accept ISR delays. However, you can handle PCI MSI interrupts in a UMDF driver. These interrupts have edge semantics and are not shared.</p>
<p>  
Typically, the <a href="wdf.oninterruptisr"><i>OnInterruptIsr</i></a> callback function schedules a workitem to process the saved information later. Framework-based drivers implement workitem routines as <a href="wdf.oninterruptworkitem"><i>OnInterruptWorkItem</i></a> callback functions.</p>
<p> 
Most drivers use a single <a href="wdf.oninterruptworkitem"><i>OnInterruptWorkItem</i></a> callback function for each type of interrupt. To schedule execution of an <i>OnInterruptWorkItem</i> callback function, a driver must call <a href="wdf.iwdfinterrupt_queueworkitemforisr"><b>IWDFInterrupt::QueueWorkItemForIsr</b></a> from within the <a href="wdf.oninterruptisr"><i>OnInterruptIsr</i></a> callback function.
</p>
<p>If your driver creates multiple framework queue objects for each device, you might consider using a separate workitem object and <a href="wdf.onworkitem"><i>OnWorkItem</i></a> callback function for each queue. To schedule execution of an <i>OnWorkItem</i> callback function, the driver must first create one or more workitem objects by calling <a href="wdf.iwdfdevice3_createworkitem"><b>IWdfDevice3::CreateWorkItem</b></a>, typically from the driver's <a href="wdf.idriverentry_ondeviceadd"><b>IDriverEntry::OnDeviceAdd</b></a> callback function. Then the driver's <a href="wdf.oninterruptisr"><i>OnInterruptIsr</i></a> callback function can call <a href="wdf.iwdfworkitem_enqueue"><b>IWDFWorkItem::Enqueue</b></a>.</p>
<p>Drivers typically complete I/O requests in their <a href="wdf.oninterruptworkitem"><i>OnInterruptWorkItem</i></a> or <a href="wdf.onworkitem"><i>OnWorkItem</i></a> callback functions.</p>
<p>For an example of a UMDF driver that handles interrupts, see the <a href="http://go.microsoft.com/fwlink/p/?linkid=256189">SpbAccelerometer</a> sample driver, available starting in the Windows 8 WDK.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Servicing an Interrupt%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
