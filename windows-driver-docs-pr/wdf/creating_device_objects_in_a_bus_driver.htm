<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Creating Device Objects in a Bus Driver"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Creating Device Objects in a Bus Driver</title>

<meta name="MS-HAID" content="Ch4_DFPnPPackage_65fc99d1-6cdf-4df4-8425-3227385d4961.xml"/>
<meta name="MS-HAID" content="kmdf.creating_device_objects_in_a_bus_driver"/>
<meta name="MS-HAID" content="wdf.creating_device_objects_in_a_bus_driver"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.creating_device_objects_in_a_bus_driver"></a>Creating Device Objects in a Bus Driver</h1>
</div>
<p>Each <a href="kernel.bus_drivers">bus driver</a> must create a framework device object when it discovers that a child device is connected to a parent device. The parent device is typically a bus, but it can also be a multifunction device for which each function requires a separate set of drivers (such as a sound card that supports digital audio and MIDI). The device objects that bus drivers create are called physical device objects (PDOs) because each represents an actual connection of one piece of hardware (the child) to another (the parent).</p>
<p>The process of identifying and reporting the devices that are connected to a bus is called <i>bus enumeration</i>. </p>
<ul>
<li>
<p>If a bus driver performs <a href="dynamic_enumeration.htm">dynamic bus enumeration</a>, its <a href="wdf.evtchildlistcreatedevice"><i>EvtChildListCreateDevice</i></a> callback function receives a handle to a <a href="wdf.wdfdevice_init"><b>WDFDEVICE_INIT</b></a> structure.</p>
</li>
<li>
<p>If a bus driver performs <a href="static_enumeration.htm">static bus enumeration</a>, it must call <a href="wdf.wdfpdoinitallocate"><b>WdfPdoInitAllocate</b></a> to obtain a handle to a WDFDEVICE_INIT structure. </p>
</li>
</ul>
<p>For more information about bus enumeration, see <a href="enumerating_the_devices_on_a_bus.htm">Enumerating the Devices on a Bus</a>.</p>
<p>A bus driver can call a set of <a href="wdf.wdf_device_object_reference#device_init_methods#device_init_methods">framework device object initialization methods</a>, which store information in the <a href="wdf.wdfdevice_init"><b>WDFDEVICE_INIT</b></a> structure. Additionally, bus drivers can call <a href="wdf.wdf_device_object_reference#pdo_init_methods#pdo_init_methods">framework PDO initialization methods</a>.</p>
<p>Creating a framework device object for an enumerated child device typically includes the following steps:</p>
<ul>
<li>
<p>Registering bus driver-specific callback functions.</p>
<p>Most bus drivers call <a href="wdf.wdfpdoinitseteventcallbacks"><b>WdfPdoInitSetEventCallbacks</b></a>, because they must specify the system hardware resources that a device requires. For more information about specifying hardware resources, see <a href="hardware_resources_for_kmdf_drivers.htm">Hardware Resources for Framework-Based Drivers</a>. Additional callback functions can be registered if the device and driver support ejection.</p>
</li>
<li>
<p>Reporting <a href="devinst.device_identification_strings">device identification strings</a>.</p>
<p>Bus drivers must report the device's identification strings by calling <a href="wdf.wdfpdoinitassigndeviceid"><b>WdfPdoInitAssignDeviceID</b></a>, <a href="wdf.wdfpdoinitassigninstanceid"><b>WdfPdoInitAssignInstanceID</b></a>, <a href="wdf.wdfpdoinitaddcompatibleid"><b>WdfPdoInitAddCompatibleID</b></a>, and <a href="wdf.wdfpdoinitaddhardwareid"><b>WdfPdoInitAddHardwareID</b></a> for each type of string that the device supports. In addition, bus drivers that use version 1.9 or later of the framework can call <a href="wdf.wdfpdoinitassigncontainerid"><b>WdfPdoInitAssignContainerID</b></a>.</p>
</li>
<li>
<p>Reporting whether the bus driver can support the device in raw mode.</p>
<p>If the bus driver supports raw mode for the device, it must call <a href="wdf.wdfpdoinitassignrawdevice"><b>WdfPdoInitAssignRawDevice</b></a>.</p>
</li>
<li>
<p>Providing displayable text that describes the device.</p>
<p>Bus drivers call <a href="wdf.wdfpdoinitadddevicetext"><b>WdfPdoInitAddDeviceText</b></a> and <a href="wdf.wdfpdoinitsetdefaultlocale"><b>WdfPdoInitSetDefaultLocale</b></a> to provide text that describes the device to users, in multiple languages.</p>
</li>
<li>
<p>Creating the device object.</p>
<p>The final step in creating a device object is to call <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>. </p>
</li>
</ul>
<p>If the driver encounters an error while initializing the WDFDEVICE_INIT structure that it obtained from <a href="wdf.wdfpdoinitallocate"><b>WdfPdoInitAllocate</b></a>, the driver must call <a href="wdf.wdfdeviceinitfree"><b>WdfDeviceInitFree</b></a> instead of <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a>. </p>
<p>After the bus driver has created the device object, it typically calls <a href="wdf.wdfdevicesetpnpcapabilities"><b>WdfDeviceSetPnpCapabilities</b></a> and <a href="wdf.wdfdevicesetpowercapabilities"><b>WdfDeviceSetPowerCapabilities</b></a> to report the device's Plug and Play and power capabilities.</p>
<p>Each bus driver is also the function driver for the bus adapter. Therefore, the driver must also provide an <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function. This callback function creates a functional device object (FDO) for each bus adapter on the system. For more information about creating FDOs, see <a href="creating_device_objects_in_a_function_driver.htm">Creating Device Objects in a Function Driver</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Creating Device Objects in a Bus Driver%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
