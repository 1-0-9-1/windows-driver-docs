<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Using UMDF Verifier"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Using UMDF Verifier</title>

<meta name="MS-HAID" content="wdf.umdf_verifier"/>
<meta name="MS-HAID" content="wdf.umdf_verifier_options"/>
<meta name="MS-HAID" content="wdf.using_umdf_verifier"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.using_umdf_verifier"></a>Using UMDF Verifier</h1>
</div>
<p>The framework provides built-in verification functionality that you can use to test a running User-Mode Driver Framework (UMDF) driver. This functionality, sometimes called UMDF Verifier, extensively validates your driver's state and the arguments that the driver passes to framework object methods. You can use UMDF Verifier by itself or together with the general-purpose <a href="http://www.microsoft.com/en-us/download/details.aspx?id=20028">Application Verifier (AppVerif.exe)</a> tool.</p>
<p>UMDF Verifier checks lock acquisition and hierarchies, verifies correct I/O cancellation and queue usage, and ensures that the driver and framework follow the documented contracts.</p>
<p>UMDF Verifier causes failures in UMDF driver code to <i>bug check</i> the host process. However, a UMDF bug check does not cause a blue text screen to appear with information about the error. Instead, a UMDF bug check:</p>
<ul>
<li>
<p>Creates a memory dump file and saves the file to the computer's log file directory (for example, %windir%\System32\LogFiles\WUDF\<i>Xxx</i>.dmp).</p>
<div class="alert"><b>Note</b>  Starting in UMDF 2.15, the log directory is <i>%ProgramData%</i>\Microsoft\WDF.</div>
<div> </div>
</li>
<li>
<p>Creates an <a href="how_umdf_reports_errors.htm">error report</a> for Microsoft (opt-in).</p>
</li>
<li>
<p>Breaks into the debugger if one is attached to the computer.</p>
</li>
<li>
<p>Terminates the host process and disables the device.</p>
</li>
</ul>
<p>Starting in UMDF 2.0, UMDF Verifier issues breakpoints in some cases, and causes a UMDF bug check in others. This behavior is similar to that of KMDF Verifier.</p>
<p>We recommend running <a href="http://www.microsoft.com/en-us/download/details.aspx?id=20028">Application Verifier (AppVerif.exe)</a> on WUDFHost.exe while testing or debugging your UMDF driver. Use the following command, and then reboot.</p>
<pre class="syntax" xml:space="preserve"><code>
AppVerif –enable Heaps Exceptions Handles Locks Memory TLS Leak –for WudfHost.exe
</code></pre>
<p>Starting in version 2.0 of UMDF, if you run <a href="http://www.microsoft.com/en-us/download/details.aspx?id=20028">Application Verifier</a> on the driver host process (Wudfhost), UMDF Verifier is automatically enabled for all UMDF 2.0 drivers in that host, as well as all UMDF 2.0 drivers in future driver host processes.</p>
<p>In UMDF 1.11 and earlier, the framework's verifier is always on and you cannot turn it off.</p>
<h2><a id="Enabling_and_Disabling_UMDF_Verifier"></a><a id="enabling_and_disabling_umdf_verifier"></a><a id="ENABLING_AND_DISABLING_UMDF_VERIFIER"></a>Enabling and Disabling UMDF Verifier</h2>
<p>You can manually enable UMDF Verifier by setting <b>VerifierOn</b> to a nonzero value in the driver's <b>Parameters\Wdf</b> subkey of the <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF\Services\&lt;driver name&gt;</b>   registry key.</p>
<div class="alert"><b>Note</b>  The existence of a <b>VerifierOn</b> value at all, even set to zero, overrides the linkage with Application Verifier. As a result, we recommend deleting the value if you're not forcing it on, rather than setting it to zero.</div>
<div> </div>
<p>To determine whether UMDF Verifier is enabled, set a breakpoint at a location after your driver calls <a href="wdf.wdfdrivercreate"><b>WdfDriverCreate</b></a> and use the <a href="debugger._wdfkd_wdfdriverinfo"><b>!wdfdriverinfo</b></a> debugger extension command:</p>
<p><b>!wdfkd.wdfdriverinfo </b><i>&lt;your drivername&gt;</i><b> </b><b>0x1</b></p>
<p>For more information about the debugger extension commands, see <a href="debugger_extensions_for_kmdf_drivers.htm">Debugger Extensions for Framework-based Drivers</a>.</p>
<h2><a id="verifier_reg_values"></a><a id="VERIFIER_REG_VALUES"></a>Controlling the Verifier's Behavior</h2>
<p>You can control the behavior of UMDF Verifier by modifying values in the registry. Alternatively, you can use the <a href="devtest.wdf_verifier_control_application">WDF Verifier control application</a> to set these values.</p>
<p>The following registry values can be used with UMDF 1.<i>x</i> drivers, as well as UMDF 2.0 and later drivers.</p>
<p></p>
<dl>
<dt><a id="VerifyDownLevel______________REG_DWORD_"></a><a id="verifydownlevel______________reg_dword_"></a><a id="VERIFYDOWNLEVEL______________REG_DWORD_"></a><b>VerifyDownLevel</b>
            (<b>REG_DWORD</b>)</dt>
<dd>
<p>If <b>VerifyDownLevel</b> is set to a nonzero value, and if the driver was built with a version of the framework that is older than the current version, the framework's verifier includes tests that were added after the driver was built. If this value does not exist or is set to zero, the framework's verifier includes only the tests that existed when the driver was built. </p>
<p>For example, if your driver was built with version 1.7 of the framework, and if version 1.9 of the framework is installed on the computer, setting <b>VerifyDownLevel</b> to nonzero causes the verifier to include tests that were added to version 1.9 of the verifier when your driver runs.</p>
<p>This value is located in the <b>Parameters\Wdf</b> subkey of the  <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF\Services\<i>DriverName</i></b> registry key.</p>
</dd>
<dt><a id="TrackObjects_____________________________REG_DWORD_"></a><a id="trackobjects_____________________________reg_dword_"></a><a id="TRACKOBJECTS_____________________________REG_DWORD_"></a><b>TrackObjects</b>
              
            (<b>REG_DWORD</b>)</dt>
<dd>
<p>If <b>TrackObjects</b> is set to a nonzero value, the framework enters the debugger when the driver is unloaded, if any framework-based objects have <a href="determining_if_a_driver_leaks_framework_objects.htm">leaked</a> (not been deleted).</p>
<p>During regular testing, you should enable <b>TrackObjects</b> and not  <b>TrackRefCounts</b>. If the verifier reports that the driver is leaking framework objects, then use the control application to enable the <b>TrackRefCounts</b> verifier option.</p>
<p>This value is located in the <i>DefaultHostProcessGuid</i> subkey of the <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF\Services</b> registry key, where <i>DefaultHostProcessGuid</i> is a value that you can find in the <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF</b> subkey.</p>
</dd>
<dt><a id="TrackRefCounts_____________________________REG_DWORD_"></a><a id="trackrefcounts_____________________________reg_dword_"></a><a id="TRACKREFCOUNTS_____________________________REG_DWORD_"></a><b>TrackRefCounts</b>
              
            (<b>REG_DWORD</b>)</dt>
<dd>
<p>If <b>TrackRefCounts</b> is set to a nonzero value, the framework maintains a count of the number of references to each framework-based object. You can use the <a href="using_umdf_debugger_extensions.htm">!wudfrefhist</a> debugger extension to view the changes of an object's reference count. </p>
<p>Setting <b>TrackRefCounts</b> to a nonzero value degrades the driver's performance, so you should leave the value at zero unless you are debugging an object deletion bug.</p>
<p>This value is located in the <i>DefaultHostProcessGuid</i> subkey of the <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF\Services</b> registry key, where <i>DefaultHostProcessGuid</i> is a value that you can find in the <b>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WUDF</b> subkey.</p>
</dd>
</dl>
<p>In addition to the registry values listed above, UMDF 2.0 and later drivers can also use many of the registry values listed in <a href="using_kmdf_verifier.htm">Using KMDF Verifier</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Using UMDF Verifier%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
