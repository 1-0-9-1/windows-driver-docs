<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Reporting Device Powered On When System Returns to S0"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Reporting Device Powered On When System Returns to S0</title>

<meta name="MS-HAID" content="kmdf.reporting_device_powered_on"/>
<meta name="MS-HAID" content="wdf.reporting_device_powered_on"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.reporting_device_powered_on"></a>Reporting Device Powered On When System Returns to S0</h1>
</div>
<p class="CCE_Message">[Applies to KMDF only]</p>
<p>When the system returns to its working (S0) state from a low-power state,  the PnP manager sends a system set-power IRP (<a href="kernel.irp_mn_set_power"><b>IRP_MN_SET_POWER</b></a>) to return the device to its working (D0) state. WDF handles the system set-power IRP. However, because in the multi-component scenario the driver has directly registered with the power management framework (PoFx), the driver must call <a href="kernel.pofxreportdevicepoweredon"><b>PoFxReportDevicePoweredOn</b></a> when the device has completed the transition to its fully on (D0) power state.  The driver can accomplish this by registering a WDM preprocess routine to receive notification when a system set-power IRP arrives.</p>
<p>The driver can use the following procedure:<ol>
<li>Call <a href="wdf.wdfdeviceinitassignwdmirppreprocesscallback"><b>WdfDeviceInitAssignWdmIrpPreprocessCallback</b></a> to register a <a href="wdf.evtdevicewdmirppreprocess"><i>EvtDeviceWdmIrpPreprocess</i></a> callback function for <a href="kernel.irp_mn_set_power"><b>IRP_MN_SET_POWER</b></a>. In the callback,  the driver sets a flag in its device extension to indicate that it needs to call <a href="kernel.pofxreportdevicepoweredon"><b>PoFxReportDevicePoweredOn</b></a> from its next <a href="wdf.evtdeviced0entry"><i>EvtDeviceD0Entry</i></a> callback.</li>
<li>In <a href="wdf.evtdeviced0entry"><i>EvtDeviceD0Entry</i></a>, if the flag is set, the driver clears the flag and calls <a href="kernel.pofxreportdevicepoweredon"><b>PoFxReportDevicePoweredOn</b></a>.</li>
<li>The driver also checks the flag in <a href="wdf.evtdeviceselfmanagedioflush"><i>EvtDeviceSelfManagedIoFlush</i></a>. If the flag is set, the device failed to return to D0 and the device has been removed. In this case, the driver calls <a href="kernel.pofxreportdevicepoweredon"><b>PoFxReportDevicePoweredOn</b></a> and then unregisters with the power framework. </li>
</ol>
</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Reporting Device Powered On When System Returns to S0%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
