<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Controlling Device Access in KMDF Drivers"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Controlling Device Access in KMDF Drivers</title>

<meta name="MS-HAID" content="Ch8_DFTechniques_90793919-5332-4ded-b7d1-4a0e73a209fc.xml"/>
<meta name="MS-HAID" content="kmdf.controlling_device_access_in_framework_based_drivers"/>
<meta name="MS-HAID" content="kmdf.controlling_device_access_in_kmdf_drivers"/>
<meta name="MS-HAID" content="wdf.controlling_device_access_in_kmdf_drivers"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.controlling_device_access_in_kmdf_drivers"></a>Controlling Device Access in KMDF Drivers</h1>
</div>
<p>Drivers must help to prevent users from inappropriately accessing a computer's devices and files. To prevent unauthorized access to devices and files, you must:</p>
<ul>
<li>
<p>
       Name device objects only when necessary. </p>
</li>
<li>
<p>
       Provide security descriptors for device objects and interfaces. </p>
</li>
</ul>
<h3><a id="naming_device_objects_only_when_necessary"></a><a id="NAMING_DEVICE_OBJECTS_ONLY_WHEN_NECESSARY"></a>
      Naming Device Objects Only When Necessary</h3>
<p>Like most Windows Driver Model (WDM) drivers, framework-based drivers typically do not name their device objects. Applications can access a device by specifying a device object name, so each additional device object name represents an additional path that an application can use to access the device. </p>
<p>To prevent unauthorized access to a device, each driver can specify a security descriptor when it names a device object. However, the file name that the operating system provides to a driver (see <a href="wdf.wdffileobjectgetfilename"><b>WdfFileObjectGetFileName</b></a>) does not include the device object name that the application used. Therefore, if several drivers in your driver's stack provide names for their device objects, your driver cannot determine which object name the application used to open the device. As a result, an application might open the device with a less restrictive security descriptor than your driver expects.</p>
<p>Physical device objects (PDOs) must have names. Typically, framework-based bus drivers do not specify a name for a PDO, because the framework (by default) instructs the operating system to generate a name. </p>
<p>On the other hand, a framework-based driver can assign a device name to a device object by calling <a href="wdf.wdfdeviceinitassignname"><b>WdfDeviceInitAssignName</b></a>. A driver should name a functional device object (FDO), filter device object (filter DO), or PDO only if the driver must support an older application that expects a specific device name, or if the driver belongs to an older driver stack whose architecture requires object names.</p>
<p>Instead of naming FDOs and filter DOs, WDM drivers and framework-based drivers should provide raw mode, without a function driver.</p>
<p>Some drivers must call <a href="wdf.wdfdevicecreatesymboliclink"><b>WdfDeviceCreateSymbolicLink</b></a> to create symbolic link names for their devices. For example, a driver might create an <a href="kernel.introduction_to_ms_dos_device_names">MS-DOS device name</a> if applications expect to see an MS-DOS name for the device. If your driver creates a symbolic link name for an unnamed FDO or filter DO, the framework associates the symbolic link name with the PDO's name. (Control devices are not associated with a PDO, so your driver cannot create a symbolic link name for an unnamed control device.)</p>
<h3><a id="providing_security_descriptors_for_device_objects_and_interfaces"></a><a id="PROVIDING_SECURITY_DESCRIPTORS_FOR_DEVICE_OBJECTS_AND_INTERFACES"></a>
      Providing Security Descriptors for Device Objects and Interfaces</h3>
<p>Every named device object must have a security descriptor. The operating system uses the device object's security descriptor to determine the types of users that are allowed to access a device and its device interfaces. Security descriptors can be assigned to device objects by:</p>
<ul>
<li>
<p> The operating system, which provides a default security descriptor for device objects (see <a href="kernel.controlling_device_access">Controlling Device Access</a>).  </p>
</li>
<li>
<p> The framework, which provides a default security descriptor (by using the SDDL_DEVOBJ_SYS_ALL_ADM_ALL value) if your driver calls <a href="wdf.wdfdeviceinitassignname"><b>WdfDeviceInitAssignName</b></a> to assign a name to a device object (see <a href="kernel.sddl_for_device_objects">SDDL for Device Objects</a>).  </p>
</li>
<li>
<p> Your driver, which can override the framework's default security descriptor by calling <a href="wdf.wdfdeviceinitassignsddlstring"><b>WdfDeviceInitAssignSDDLString</b></a>. </p>
</li>
</ul>
<p>By default, the operating system also uses the device PDO's security descriptor to determine access rights to the device interfaces that a driver provides. </p>
<p>A driver package can provide an INF file that specifies a device's security descriptors, as follows:</p>
<ul>
<li>
<p> To specify security descriptors for a type of device, the INF file can contain an <a href="devinst.inf_addreg_directive"><b>INF AddReg directive</b></a> within an <a href="devinst.inf_ddinstall_hw_section"><b>INF DDInstall.HW section</b></a>. </p>
</li>
<li>
<p> To specify security descriptors for all types of devices within a device setup class, the INF file can contain an <a href="devinst.inf_addreg_directive"><b>INF AddReg directive</b></a> within an <a href="devinst.inf_classinstall32_section"><b>INF ClassInstall32 section</b></a>. </p>
</li>
</ul>
<p>For more information about specifying security descriptors in INF files, see <a href="devinst.creating_secure_device_installations">Creating Secure Device Installations</a>.</p>
<p>If your driver creates PDOs for devices that operate in raw mode, the driver must specify a <a href="devinst.device_setup_classes">device setup class</a> when it calls <a href="wdf.wdfpdoinitassignrawdevice"><b>WdfPdoInitAssignRawDevice</b></a>. Additionally, if your driver creates control devices, it can call <a href="wdf.wdfdeviceinitsetdeviceclass"><b>WdfDeviceInitSetDeviceClass</b></a> to specify a device setup class. In both of these cases, system administrators can use the registry key of the specified setup class to store security descriptors for the device.</p>
<p>For information about how the operating system determines which security descriptor to use for a device, see <a href="kernel.controlling_device_access">Controlling Device Access</a>.</p>
<p>When the framework creates a device object, it always sets the FILE_DEVICE_SECURE_OPEN flag so that the operating system will check a device's security descriptor before allowing an application to access any names within the device's namespace. For more information about the FILE_DEVICE_SECURE_OPEN flag and device namespace, see <a href="kernel.controlling_device_namespace_access">Controlling Device Namespace Access</a>. </p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Controlling Device Access in KMDF Drivers%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
