<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="If you include a co-installer in your driver package, read this topic for information about sections you must provide in your driver's INF file."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Specifying the  KMDF Co-installer in an INF File</title>

<meta name="MS-HAID" content="Ch0_DFArchOverview_6b31a386-0b4c-4158-a1bc-9959e3db07b9.xml"/>
<meta name="MS-HAID" content="kmdf.installing_the_framework_s_co_installer"/>
<meta name="MS-HAID" content="wdf.installing_the_framework_s_co_installer"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.installing_the_framework_s_co_installer"></a>Specifying the  KMDF Co-installer in an INF File</h1>
</div>
<p>  If you include a co-installer in your <a href="devinst.components_of_a_driver_package">driver package</a>, read this topic for information about sections you must provide in your driver's INF file. This information does not apply if you provide your own setup application that calls Microsoft-supplied .msu redistributables.</p>
<h2><a id="_____________INF_File_Sections_for_the_Co-installer"></a><a id="_____________inf_file_sections_for_the_co-installer"></a><a id="_____________INF_FILE_SECTIONS_FOR_THE_CO-INSTALLER"></a>
            INF File Sections for the Co-installer</h2>
<p>Your driver's INF file must contain an INF <i>DDInstall</i><b>.CoInstallers</b> section that installs the co-installer. For example this section might be named <b>MyDevice.ntx86.CoInstallers</b>. For more information about specifying a co-installer in an INF file, see <a href="devinst.inf_ddinstall_coinstallers_section"><b>INF DDInstall.CoInstallers Section</b></a>.</p>
<p>In addition, your driver's INF file must contain an INF <i>DDInstall</i><b>.Wdf</b> section that the co-installer reads after it has been installed. For example, this section might be named <b>MyDevice.ntx86.Wdf</b>. After the framework's co-installer has been installed, it reads this section while it is installing your driver.</p>
<p>The INF <i>DDInstall</i><b>.Wdf</b> section contains the following directive:</p>
<dl>
<dd>
<p><b>KmdfService = </b><i>DriverService</i><b>,</b><i>Wdf-install-section</i></p>
</dd>
</dl>
<p><i>DriverService</i> represents the name that the operating system will assign to your driver's kernel-mode service, and <i>Wdf-install-section</i> represents the name of an INF section that the co-installer reads to obtain information about your driver.</p>
<p>The INF section that <i>Wdf-install-section</i> identifies must contain the following directive:</p>
<dl>
<dd>
<p><b>KmdfLibraryVersion = </b><i>WdfLibraryVersion</i></p>
</dd>
</dl>
<p><i>WdfLibraryVersion</i> represents a library version number, such as "1.0" or "1.11".</p>
<p>For example, the following INF <i>DDInstall</i><b>.Wdf</b> section specifies <b>Echo_wdfsect </b>as the <i>Wdf-install-section</i> name.</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>[ECHO_Device.NT.Wdf]
KmdfService = Echo, Echo_wdfsect
[Echo_wdfsect]
KmdfLibraryVersion = 1.0</pre>
</td>
</tr>
</table></span></div>
<p>You can avoid creating multiple INF files for multiple versions of the framework by using INX files and the <a href="devtest.stampinf">Stampinf</a> tool. For more information about INX files, see <a href="using_inx_files_to_create_inf_files.htm">Using INX Files to Create INF Files</a>. </p>
<h3><a id="sample_inf_ddinstall_coinstallers_and_ddinstall_wdf_sections"></a><a id="SAMPLE_INF_DDINSTALL_COINSTALLERS_AND_DDINSTALL_WDF_SECTIONS"></a><b>Sample INF </b><b><i>DDInstall</i></b><b>.CoInstallers and </b><b><i>DDInstall</i></b><b>.Wdf Sections</b></h3>
<p>The following code example shows how to create the INF <i>DDInstall</i><b>.CoInstallers</b> section and INF <i>DDInstall</i><b>.Wdf</b> section of an INF file for a PnP driver. The example shows how to create an INF file that is called <i>MyDevice.inf</i> and is based on the <a href="http://go.microsoft.com/fwlink/p/?linkid=256129">ECHO</a> sample driver's <i>Echo.inf</i> file. The Echo sample driver is located in the samples directory of the WDK.</p>
<p>To create <i>MyDevice.inf</i>, you must change all <b>ECHO_Device</b> substrings in <i>Echo.inf </i>to a name that is appropriate for your product. The following code example uses <b>MyDevice</b>.</p>
<p>You should attempt to match the section layout that the <i>Echo.inf</i> sample uses. In other words, if possible, keep the co-installer-related sections together to more easily spot cut-and-paste errors.</p>
<p>Before you have modified <i>echo.inf</i>, the sections that install the co-installer are as follows:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>=============== Top of Echo.inf ====================
....
....
[DestinationDirs]
DefaultDestDir = 12
ECHO_Device_CoInstaller_CopyFiles = 11
....
....
;
;--- ECHO_Device Co-installer installation ------
;
[ECHO_Device.NT.CoInstallers]
AddReg=ECHO_Device_CoInstaller_AddReg
CopyFiles=ECHO_Device_CoInstaller_CopyFiles

[ECHO_Device_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller01000.dll,WdfCoInstaller"

[ECHO_Device_CoInstaller_CopyFiles]
WdfCoInstaller01000.dll

[ECHO_Device.NT.Wdf]
KmdfService = Echo, Echo_wdfsect
[Echo_wdfsect]
KmdfLibraryVersion = 1.0

===============  End of Echo.inf ===============</pre>
</td>
</tr>
</table></span></div>
<p>After you have changed all <b>ECHO_Device</b> substrings, your <i>MyDevice.inf</i> file should appear as follows:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>=============== Top of MyDevice.inf ===============
....
....
[DestinationDirs]
DefaultDestDir = 12
MyDevice_CoInstaller_CopyFiles = 11
....
....
;
;--- MyDevice Co-installer installation ------
;
[MyDevice.NT.CoInstallers]
AddReg=MyDevice_CoInstaller_AddReg
CopyFiles=MyDevice_CoInstaller_CopyFiles

[MyDevice_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller01000.dll,WdfCoInstaller"

[MyDevice_CoInstaller_CopyFiles]
WdfCoInstaller01000.dll

[MyDevice_Device.NT.Wdf]
KmdfService = MyDevice, MyDevice_wdfsect
[MyDevice_wdfsect]
KmdfLibraryVersion = 1.0
....
....
=============== End of MyDevice.inf ===============</pre>
</td>
</tr>
</table></span></div>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Specifying the  KMDF Co-installer in an INF File%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
