<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Using the Framework's Event Logger"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Using the Framework's Event Logger</title>

<meta name="MS-HAID" content="Ch0_DFArchOverview_9f941860-be3a-4da4-9109-9e0edcfe302c.xml"/>
<meta name="MS-HAID" content="kmdf.using_the_framework_s_event_logger"/>
<meta name="MS-HAID" content="wdf.using_the_framework_s_event_logger"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.using_the_framework_s_event_logger"></a>Using the Framework's Event Logger</h1>
</div>
<p>WDF  includes an internal trace logger, sometimes called the framework's <i>In-flight Recorder</i> (IFR). The WDF logger creates a trace log that contains a recent history of events for each WDF driver. The trace logs track the progress of I/O request packets (IRPs) through the framework and the corresponding requests through a driver. Each Kernel-Mode Driver Framework (KMDF) and User-Mode Driver Framework (UMDF) driver has its own log.</p>
<p>The WDF logger is always enabled.  For each trace log, the logger stores event records in a circular memory buffer. Optionally, you can turn on verbosity, which causes the event logger to record additional information that can help you debug your driver, such as entries into or exits from internal code paths. By default, the size of the buffer is one memory page and verbosity is turned off.   You can change the buffer's size and verbosity by adjusting these values within the <a href="devtest.wdf_verifier_control_application">WdfVerifier application</a>. Note that turning on verbosity might degrade system performance.</p>
<p>You can use WDF debugger extensions to view and save the WDF log during interactive debugging.  To view the WDF log during a debugging session:</p>
<ol>
<li>
<p>Load the correct symbols. You can use the <a href="debugger._symfix__set_symbol_store_path_"><b>.symfix</b></a>+  debugger command to append the Microsoft public symbol store to your existing symbol path.  The public symbol store includes symbols for the WDF binaries. You might also want to load symbols for your driver symbols.</p>
<p>For additional information about how to obtain Window symbols and how to set the debugger's symbol path, see the documentation that is supplied with the <a href="debugger.introduction6">Windows Debugging</a> package.</p>
</li>
<li>
<p>Load the <a href="debugger_extensions_for_kmdf_drivers.htm">Wdfkd.dll extension library</a> into your debugger. If you are using the kernel debugger, you can do this by using the  <a href="debugger._load___loadby__load_extension_dll_"><b> .load</b></a> command. To load the correct version of Wdfkd.dll you need to specify the fully qualified path to the DLL. For example, you would use the following path on an x86-based debugger host machine:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>.load c:\WinDDK\&lt;version&gt;\bin\x86\wdfkd.dll</pre>
</td>
</tr>
</table></span></div>
<p>  You can then confirm that the extension is loaded by using the  <a href="debugger._chain__list_debugger_extensions_"><b>!chain</b></a> command to display all loaded extensions.</p>
<p>For more information about the framework debugger extension, use the <a href="debugger._wdfkd_wdfhelp"><b>!wdfhelp</b></a> extension.  For more information about the kernel debugger, see the documentation that is supplied with the <a href="debugger.introduction6">Windows Debugging</a> package.</p>
</li>
<li>
<p>If your driver uses framework version 1.11 or later, and you are using the kernel debugger from Windows 8 or later, you can skip this step.</p>
<p> If your driver uses a framework version that is earlier than 1.11, use <a href="debugger._wdfkd_wdftmffile"><b>!wdftmffile</b></a> or <a href="debugger._wdfkd_wdfsearchpath"><b>!wdfsearchpath</b></a> to specify a platform-specific trace message format (.tmf) file, or a path to a .tmf file.  The .tmf files are located in platform-specific subdirectories in the WDK.</p>
<p>Because .tmf  files are version specific, you must specify a .tmf  file that corresponds to the version of the framework's runtime library that is currently running. For example, if KMDF version 1.9 is running on the host machine:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>!wdftmffile c:\WinDDK\&lt;version&gt;\tools\tracing\x86\wdf01009.tmf</pre>
</td>
</tr>
</table></span></div>
<p>  You can also set the search path by setting the TRACE_FORMAT_SEARCH_PATH environment variable. The <a href="debugger._wdfkd_wdftmffile"><b>!wdftmffile</b></a> command takes precedence over the search path that is set by the environment variable.</p>
<p>To verify the framework version number, you can run the <a href="debugger._wdfkd_wdfldr"><b>!wdfldr</b></a> debugger extension command from the kernel debugger.</p>
</li>
<li>
<p>Use the <a href="debugger._wdfkd_wdflogdump"><b>!wdflogdump</b></a> extension to display the event logger's records.  For example, the following screenshot of a WinDbg Command window shows a typical example of the output of <b>!wdflogdump</b>:</p>
<p><img src="images/kmdf_using_wdflogdump.png" alt="Sample Output from the !wdflogdump Extension"/></p>
</li>
</ol>
<p>Each line in the framework's log is preceded by a string that is called the <a href="devtest.trace_message_prefix">trace message prefix</a>. The trace logger prepends this prefix to each message that is written to the log. By default, the prefix includes a standard set of data elements, but you can change the default elements to suit your particular requirements.

You can change the prefix string for a WDF driver by setting the TRACE_FORMAT_PREFIX environment variable or by using the <a href="debugger._wdfkd_wdfsettraceprefix"><b>!wdfsettraceprefix</b></a> debugger extension command.</p>
<p>To set the environment variable, use a command similar to the following:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>Set TRACE_FORMAT_PREFIX=%2!s!: %!FUNC!: %8!04x!.%3!04x!: %4!s!:</pre>
</td>
</tr>
</table></span></div>
<p>This command sets the trace message prefix to the following:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>SourceFile_LineNumber: FunctionName: ProcessID.ThreadID: SystemTime</pre>
</td>
</tr>
</table></span></div>
<p>You can also use the <a href="debugger._wdfkd_wdflogsave"><b>!wdflogsave</b></a> extension command to save the event logger's records in an event trace log (.etl) file that you can view by using <a href="devtest.traceview">TraceView</a>.  </p>
<p>You can sometimes use the <a href="debugger._wdfkd_wdfcrashdump"><b>!wdfcrashdump</b></a> debugger extension on a crash dump to display log information after the system bug checks.  The log information is available in the crash dump only if the framework can determine that your driver caused the bug check or if you have set the <a href="registry_values_for_debugging_kmdf_drivers.htm">ForceLogsInMiniDump</a> registry value for the driver. </p>
<p>If a debugger is attached when the bug check occurs, you can either use <a href="debugger._wdfkd_wdfcrashdump"><b>!wdfcrashdump</b></a> to view the log information immediately, or you can view the information by loading the memory dump file. Due to size limitations of a small memory dump file, the log for the driver that caused the crash  might not appear in the dump.</p>
<p> The framework can determine whether a particular driver caused the following bug check codes:<ul>
<li><a href="debugger.bug_check_0xd1__driver_irql_not_less_or_equal"><b>Bug Check 0xD1: DRIVER_IRQL_NOT_LESS_OR_EQUAL</b></a></li>
<li><a href="debugger.bug_check_0xa__irql_not_less_or_equal"><b>Bug Check 0xA: IRQL_NOT_LESS_OR_EQUAL</b></a></li>
<li><a href="debugger.bug_check_0x20__kernel_apc_pending_during_exit"><b>Bug Check 0x20: KERNEL_APC_PENDING_DURING_EXIT</b></a></li>
<li><a href="debugger.bug_check_0x8e__kernel_mode_exception_not_handled"><b>Bug Check 0x8E: KERNEL_MODE_EXCEPTION_NOT_HANDLED</b></a></li>
<li><a href="debugger.bug_check_0x1e__kmode_exception_not_handled"><b>Bug Check 0x1E: KMODE_EXCEPTION_NOT_HANDLED</b></a></li>
<li><a href="debugger.bug_check_0x50__page_fault_in_nonpaged_area"><b>Bug Check 0x50: PAGE_FAULT_IN_NONPAGED_AREA
</b></a></li>
<li><a href="debugger.bug_check_0x7e__system_thread_exception_not_handled"><b>Bug Check 0x7E: SYSTEM_THREAD_EXCEPTION_NOT_HANDLED</b></a></li>
</ul>
</p>
<p>Starting in UMDF version 2, UMDF stores the UMDF trace log (or UMDF <i>IFR</i>) in kernel non-paged memory.  The framework allocates one IFR per driver host (Wudfhost) instance.</p>
<p>For more information about the debugger extension commands, see <a href="debugger_extensions_for_kmdf_drivers.htm">Debugger Extensions for Framework-based Drivers</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Using the Framework's Event Logger%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
