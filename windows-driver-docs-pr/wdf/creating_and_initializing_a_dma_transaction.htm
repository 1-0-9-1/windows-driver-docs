<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Creating and Initializing a DMA Transaction"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Creating and Initializing a DMA Transaction</title>

<meta name="MS-HAID" content="DFDmaPackage_147a0a64-0268-4530-a331-05a33986747d.xml"/>
<meta name="MS-HAID" content="kmdf.creating_and_initializing_a_dma_transaction"/>
<meta name="MS-HAID" content="wdf.creating_and_initializing_a_dma_transaction"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.creating_and_initializing_a_dma_transaction"></a>Creating and Initializing a DMA Transaction</h1>
</div>
<p class="CCE_Message">[Applies to KMDF only]</p>
<h2><a id="ddk_creating_and_initializing_a_dma_transaction_df"></a><a id="DDK_CREATING_AND_INITIALIZING_A_DMA_TRANSACTION_DF"></a></h2>
<p>Before your driver can send an I/O request to a DMA device, the driver must:</p>
<ol>
<li>
<p>Call <a href="wdf.wdfdmatransactioncreate"><b>WdfDmaTransactionCreate</b></a> to create a DMA transaction object for the request.</p>
</li>
<li>
<p>Call <a href="wdf.wdfdmatransactioninitializeusingrequest"><b>WdfDmaTransactionInitializeUsingRequest</b></a>, <a href="wdf.wdfdmatransactioninitialize"><b>WdfDmaTransactionInitialize</b></a>, or  <a href="wdf.wdfdmatransactioninitializeusingoffset"><b>WdfDmaTransactionInitializeUsingOffset</b></a>  to initialize the transaction object.</p>
</li>
</ol>
<p>Typically, your driver creates a <a href="dma_transactions_and_dma_transfers.htm">DMA transaction</a> because a <a href="request_handlers.htm">request handler</a> has received a <a href="framework_request_objects.htm">framework request object</a> and must pass the request to the hardware. In this case, the driver should call <a href="wdf.wdfdmatransactioninitializeusingrequest"><b>WdfDmaTransactionInitializeUsingRequest</b></a>, which accepts a request object handle as input and extracts the request's address parameters from the request object.</p>
<p>If your driver must create a DMA transaction that is <i>not</i> based on a framework request object that the driver received, the driver can call either <a href="wdf.wdfdmatransactioninitialize"><b>WdfDmaTransactionInitialize</b></a> or <a href="wdf.wdfdmatransactioninitializeusingoffset"><b>WdfDmaTransactionInitializeUsingOffset</b></a>. Both methods accept address parameters that the driver provides.</p>
<p>All three initialization methods require the address of an <a href="wdf.evtprogramdma"><i>EvtProgramDma</i></a> event callback function as an input parameter. This callback function programs the device, and the framework calls the callback function each time a <a href="dma_transactions_and_dma_transfers.htm">DMA transfer</a> is available.</p>
<p>When your driver calls <a href="wdf.wdfdmaenablercreate"><b>WdfDmaEnablerCreate</b></a> to create a DMA enabler object, the driver supplies a <a href="wdf.wdf_dma_enabler_config"><b>WDF_DMA_ENABLER_CONFIG</b></a> structure that contains the device's maximum transfer length. The framework uses this value as the default maximum length for all DMA transfers.</p>
<p>For some types of DMA transactions, you might need to specify a maximum transfer length that is different from the device's default maximum length. You can use <a href="wdf.wdfdmatransactionsetmaximumlength"><b>WdfDmaTransactionSetMaximumLength</b></a> to set a maximum transfer length for an individual transaction. The framework uses the specified maximum transfer length only while it processes the specified transaction.</p>
<p>Note that the maximum transfer length is limited by the number of <a href="kernel.map_registers">map registers</a> that the operating system makes available to the DMA enabler object. To determine the maximum transfer length that is available, your driver can call <a href="wdf.wdfdmaenablergetfragmentlength"><b>WdfDmaEnablerGetFragmentLength</b></a>. If the value that <b>WdfDmaEnablerGetFragmentLength</b> returns is less than the maximum transfer length that the driver supplied to <a href="wdf.wdfdmaenablercreate"><b>WdfDmaEnablerCreate</b></a>, the framework uses the smaller value.</p>
<p>After your driver creates and initializes a DMA transaction, the driver must <a href="starting_a_dma_transaction.htm">start the transaction</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Creating and Initializing a DMA Transaction%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
