<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="A User Unplugs a Device"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>A User Unplugs a Device</title>

<meta name="MS-HAID" content="umdfobjectdg_6dec020d-97a2-4648-b604-2ee720a3f087.xml"/>
<meta name="MS-HAID" content="umdf.a_user_unplugs_a_device"/>
<meta name="MS-HAID" content="wdf.a_user_unplugs_a_device_umdf"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.a_user_unplugs_a_device_umdf"></a>A User Unplugs a Device</h1>
</div>
<p class="CCE_Message">[This topic applies to UMDF 1.<i>x</i>.]</p>
<p>While a system is running, a user can remove a device in one of the following two ways: by <i>orderly removal</i>, which means that the user informs the system that the device is about to be removed (for example, by using the Unplug or Eject Hardware program); or by <i>surprise removal</i>, which means that the user unplugs the device without informing the system. If the bus supports surprise removal (for example, USB), the device's drivers must be able to handle the device's sudden disappearance.</p>
<p></p>
<dl>
<dt><a id="Orderly_Removal_______"></a><a id="orderly_removal_______"></a><a id="ORDERLY_REMOVAL_______"></a><b>Orderly Removal
      </b></dt>
<dd>
<p>The user requests removal by using the system's Unplug or Eject Hardware program, by disabling the device by using Device Manager, or by pushing an ejectable device's eject button. The framework allows the device to be removed or disabled, unless the driver has supplied an <a href="wdf.ipnpcallback_onqueryremove"><b>IPnpCallback::OnQueryRemove</b></a> callback function, and the callback function has vetoed the removal.</p>
<p>The following figure shows the sequence of UMDF callbacks in power-down and removal. The sequence starts at the top of the figure with a device that is in the working power state (D0).</p>
<p><img src="images/umdf_powerdown_sequence.png" alt="Device power-down and orderly removal sequence for a UMDF driver"/></p>
</dd>
<dt><a id="Surprise_Removal_______"></a><a id="surprise_removal_______"></a><a id="SURPRISE_REMOVAL_______"></a><b>Surprise Removal
      </b></dt>
<dd>
<p>In this scenario, a user unplugs a device unexpectedly. In the surprise-removal sequence, UMDF calls the <a href="wdf.ipnpcallback_onsurpriseremoval"><b>IPnpCallback::OnSurpriseRemoval</b></a> callback to notify the driver that the device has been unexpectedly removed. This callback is not guaranteed to occur in any particular order with the other callbacks in the removal sequence.</p>
<p>Generally, the driver should avoid accessing the hardware in the remove path. The reflector times out if an attempt to access the hardware waits indefinitely. The following figure shows the surprise-removal sequence for a UMDF driver.</p>
<p><img src="images/umdf_surprise_removal_sequence.png" alt="Surprise-removal sequence for a UMDF driver"/></p>
</dd>
</dl>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20A User Unplugs a Device%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
