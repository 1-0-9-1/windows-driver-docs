<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Using KMDF Verifier"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Using KMDF Verifier</title>

<meta name="MS-HAID" content="wdf.using_the_framework_s_verifier"/>
<meta name="MS-HAID" content="kmdf.using_the_framework_s_verifier"/>
<meta name="MS-HAID" content="wdf.using_kmdf_verifier"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.using_kmdf_verifier"></a>Using KMDF Verifier</h1>
</div>
<p>The framework provides built-in verification functionality that you can use to test a running KMDF driver. This functionality, called KMDF Verifier, extensively validates your driver's state and the arguments that the driver passes to framework object methods. You can use the framework's verifier by itself or together with the general-purpose <a href="devtest.driver_verifier">Driver Verifier (Verifier.exe)</a> tool.</p>
<p>If KMDF Verifier is enabled, the framework checks lock acquisition and hierarchies, ensures that calls to the framework occur at the correct IRQL, verifies correct I/O cancellation and queue usage, and ensures that the driver and framework follow the documented contracts. It can also simulate out-of-memory conditions so that the driver developer can test whether the driver responds properly without crashing, hanging, or failing to unload.</p>
<p>When KMDF Verifier is enabled, the framework breaks into the debugger if a default time-out period of 60 seconds expires before some of the events described previously have completed. At this point, you can debug the issue, or type "g" in the debugger to restart the time-out period. You can change the default time-out period by using the <b>DbgWaitForSignalTimeoutInSec</b> registry value described in <a href="#verifier_reg_values">Controlling the Verifier's Behavior</a>.</p>
<p>We recommend running Driver Verifier (Verifier.exe) during testing, and adding your own driver and wdf01000.sys to the verify list.</p>
<p> If your driver was built with KMDF version 1.9 or later and you run Verifier.exe, KMDF Verifier is automatically enabled.</p>
<p>You can also use the <a href="devtest.wdf_verifier_control_application">WDF Verifier Control Application (WdfVerifier.exe)</a> to enable and disable KMDF Verifier.</p>
<h2><a id="Enabling_and_Disabling_the_Framework_s_Built-in_Verification"></a><a id="enabling_and_disabling_the_framework_s_built-in_verification"></a><a id="ENABLING_AND_DISABLING_THE_FRAMEWORK_S_BUILT-IN_VERIFICATION"></a>Enabling and Disabling the Framework's Built-in Verification</h2>
<p></p>
<p>You can manually enable KMDF Verifier using this procedure:</p>
<ol>
<li>If your driver is already loaded, use Device Manager to disable the device. Disabling the device causes the driver to be unloaded.
</li>
<li>
<p>Use RegEdit to set <b>VerifierOn</b> to a nonzero value in the driver's <b>Parameters\Wdf</b> subkey of the <b>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services</b> key in the Windows registry.

A nonzero value indicates that KMDF Verifier is enabled. 
</p>
<p>You may need to add <b>VerifierOn</b> manually to the subkey if it is not already present.</p>
</li>
<li>Use Device Manager to reenable the device, thereby loading the driver.
</li>
<li>When the driver calls <a href="wdf.wdfdrivercreate"><b>WdfDriverCreate</b></a>, the framework examines the registry and enables the framework's verifier if <b>VerifierOn</b> to a nonzero value.</li>
</ol>
<p>To disable the framework's verifier, follow the same steps, but set the value of <b>VerifierOn</b> to zero.

</p>
<p>To determine whether the framework's verifier is enabled, set a breakpoint at a location after your driver calls <a href="wdf.wdfdrivercreate"><b>WdfDriverCreate</b></a> and use the <a href="debugger._wdfkd_wdfdriverinfo"><b>!wdfdriverinfo</b></a> debugger extension command:</p>
<p><b>!wdfkd.wdfdriverinfo </b><i>&lt;your drivername&gt;</i><b> </b><b>0x1</b></p>
<p>For more information about the debugger extension commands, see <a href="debugger_extensions_for_kmdf_drivers.htm">Debugger Extensions for Framework-based Drivers</a>.</p>
<h2><a id="verifier_reg_values"></a><a id="VERIFIER_REG_VALUES"></a>Controlling the Verifier's Behavior</h2>
<p>We recommend that you use the <a href="devtest.wdf_verifier_control_application">WDF Verifier control application</a> to control the options below.  However, you can directly modify the following values in the registry.</p>
<p>The relevant values are located under the <b>Parameters\Wdf</b> subkey of the <b>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services</b> key.</p>
<p></p>
<dl>
<dt><a id="VerifyOn_________________REG_DWORD_"></a><a id="verifyon_________________reg_dword_"></a><a id="VERIFYON_________________REG_DWORD_"></a><b>VerifyOn</b>
               (<b>REG_DWORD</b>)</dt>
<dd>
<p>Set this value to a nonzero value to enable the <a href="wdf.wdfverify"><b>WDFVERIFY</b></a> macro. </p>
</dd>
<dt><a id="DbgBreakOnError_____________________________REG_DWORD_"></a><a id="dbgbreakonerror_____________________________reg_dword_"></a><a id="DBGBREAKONERROR_____________________________REG_DWORD_"></a><b>DbgBreakOnError</b>
              
            (<b>REG_DWORD</b>)</dt>
<dd>
<p>If this value is set to a nonzero value, the framework will break into the debugger (if available) each time that a driver calls <a href="wdf.wdfverifierdbgbreakpoint"><b>WdfVerifierDbgBreakPoint</b></a>. </p>
</dd>
<dt><a id="DbgWaitForSignalTimeoutInSec_______________REG_DWORD_"></a><a id="dbgwaitforsignaltimeoutinsec_______________reg_dword_"></a><a id="DBGWAITFORSIGNALTIMEOUTINSEC_______________REG_DWORD_"></a><b>DbgWaitForSignalTimeoutInSec</b>
             (<b>REG_DWORD</b>)</dt>
<dd>
<p>Starting in Windows 8, when <b>VerifierOn</b> and <b>DbgBreakOnError</b> are set to nonzero values, the driver can change the default time-out period by setting <b>DbgWaitForSignalTimeoutInSec</b>.</p>
</dd>
<dt><a id="VerifierAllocateFailCount______________________________REG_DWORD_"></a><a id="verifierallocatefailcount______________________________reg_dword_"></a><a id="VERIFIERALLOCATEFAILCOUNT______________________________REG_DWORD_"></a><b>VerifierAllocateFailCount</b>
              
             (<b>REG_DWORD</b>)</dt>
<dd>
<p>If this value is set to a value <i>n</i>, the framework fails every attempt to allocate memory for the driver's objects after the <i>nth</i> allocation.</p>
</dd>
<dt><a id="TrackHandles_______________REG_MULTI_SZ_"></a><a id="trackhandles_______________reg_multi_sz_"></a><a id="TRACKHANDLES_______________REG_MULTI_SZ_"></a><b>TrackHandles</b>
             (<b>REG_MULTI_SZ</b>)</dt>
<dd>
<p>If this value is set to a list of one or more type names of framework object handles, the framework tracks references to all object handles that match the specified handle types.</p>
</dd>
<dt><a id="EnhancedVerifierOptions_____________________________REG_DWORD_"></a><a id="enhancedverifieroptions_____________________________reg_dword_"></a><a id="ENHANCEDVERIFIEROPTIONS_____________________________REG_DWORD_"></a><b>EnhancedVerifierOptions</b>
              
            (<b>REG_DWORD</b>)</dt>
<dd>
<p><b>KMDF only</b></p>
<p>Contains a bitmap that you can use to enable optional features of the framework's verifier. </p>
</dd>
<dt><a id="VerifyDownLevel______________REG_DWORD_"></a><a id="verifydownlevel______________reg_dword_"></a><a id="VERIFYDOWNLEVEL______________REG_DWORD_"></a><b>VerifyDownLevel</b>
            (<b>REG_DWORD</b>)</dt>
<dd>
<p>If set to a nonzero value, and if the driver was built with a version of the framework that is older than the current version, the framework's verifier includes tests that were added after the driver was built.</p>
</dd>
</dl>
<p>As a general rule, if you set the above registry values, delete them when they are no longer needed.</p>
<p>For full descriptions of these registry values, see <a href="registry_values_for_debugging_kmdf_drivers.htm">Registry Values for Debugging Framework-based Drivers</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Using KMDF Verifier%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
