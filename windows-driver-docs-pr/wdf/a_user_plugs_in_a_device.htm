<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="A User Plugs in a Device"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>A User Plugs in a Device</title>

<meta name="MS-HAID" content="Ch4_DFPnPPackage_6fdd3c44-4189-4bf4-bf96-8277db283300.xml"/>
<meta name="MS-HAID" content="kmdf.a_user_plugs_in_a_device"/>
<meta name="MS-HAID" content="wdf.a_user_plugs_in_a_device"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.a_user_plugs_in_a_device"></a>A User Plugs in a Device</h1>
</div>
<p>In the following scenario, the device node includes a KMDF bus driver and one or more KMDF function or filter drivers that support a PnP device.</p>
<p>When a user plugs the device into the bus while the system is running, the device's bus driver and the framework perform the following tasks:</p>
<ul>
<li>
<p>The bus driver for the device detects the device and calls <a href="wdf.wdfchildlistaddorupdatechilddescriptionaspresent"><b>WdfChildListAddOrUpdateChildDescriptionAsPresent</b></a>. (This process is known as "dynamic enumeration.")</p>
</li>
<li>
<p>The framework calls the bus driver's <a href="wdf.evtchildlistcreatedevice"><i>EvtChildListCreateDevice</i></a> callback function, so the bus driver can call <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a> to create a framework device object for the physical device (a PDO). </p>
</li>
<li>
<p>The framework calls the bus driver's <a href="wdf.evtdeviceresourcesquery"><i>EvtDeviceResourcesQuery</i></a> and <a href="wdf.evtdeviceresourcerequirementsquery"><i>EvtDeviceResourceRequirementsQuery</i></a> callback functions to determine the system hardware resources that the device requires.</p>
</li>
</ul>
<p>For more information about the power-up sequence for a KMDF  bus driver, see <a href="power-up_sequence_for_a_bus_driver.htm">Power-Up Sequence for a Bus Driver</a>.</p>
<p>Next, the PnP manager determines which additional drivers (function drivers and filter drivers) the device requires. If these drivers are not already loaded, the PnP manager loads them and calls their <a href="wdf.driverentry_for_kmdf_drivers"><b>DriverEntry</b></a> routines. For each function or filter driver, the following actions occur:</p>
<ul>
<li>
<p>The framework calls each additional driver's <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function so that the driver can call <a href="wdf.wdfdevicecreate"><b>WdfDeviceCreate</b></a> to create a framework device object that represents the device for the driver. Function drivers create a functional device object (FDO), and filter drivers create a filter device object (Filter DO).</p>
</li>
<li>
<p>The framework calls each function and filter driver's <a href="wdf.evtdevicefilterremoveresourcerequirements"><i>EvtDeviceFilterRemoveResourceRequirements</i></a> callback function and then each driver's <a href="wdf.evtdevicefilteraddresourcerequirements"><i>EvtDeviceFilterAddResourceRequirements</i></a> callback function. Immediately before the device is started, the framework calls the <a href="wdf.evtdeviceremoveaddedresources"><i>EvtDeviceRemoveAddedResources</i></a> callback function. These three callback functions allow the filter and function drivers to modify the list of hardware resources that the device requires, before the PnP manager assigns resources to the device. For more information, see <a href="hardware_resources_for_kmdf_drivers.htm">Hardware Resources for Framework-Based Drivers</a></p>
</li>
<li>
<p>The framework ensures that the device has reached its working (D0) power state. </p>
</li>
<li>For each function and filter driver that supports the device, the framework does the following, in sequence, one driver at a time, starting with the driver that is lowest in the driver stack:<ol>
<li>The framework calls the driver's <a href="wdf.evtdevicepreparehardware"><i>EvtDevicePrepareHardware</i></a> callback function (if it exists) and passes the list of hardware resources that the PnP manager has assigned to the device.</li>
<li>The framework calls the driver's <a href="wdf.evtdeviced0entry"><i>EvtDeviceD0Entry</i></a> callback function (if it exists).</li>
<li>The framework calls the driver's <a href="wdf.evtinterruptenable"><i>EvtInterruptEnable</i></a> callback function (if it exists) for each interrupt, and then it calls the driver's <a href="wdf.evtdeviced0entrypostinterruptsenabled"><i>EvtDeviceD0EntryPostInterruptsEnabled</i></a> callback function (if it exists), so that the driver can enable device interrupts.</li>
<li>If the hardware and driver support DMA, the framework calls the driver's <a href="wdf.evtdmaenablerfill"><i>EvtDmaEnablerFill</i></a>, <a href="wdf.evtdmaenablerenable"><i>EvtDmaEnablerEnable</i></a>, and <a href="wdf.evtdmaenablerselfmanagediostart"><i>EvtDmaEnablerSelfManagedIoStart</i></a> callback functions (if they exist) for each DMA channel that was created.</li>
<li>The framework calls the driver's <a href="wdf.evtchildlistscanforchildren"><i>EvtChildListScanForChildren</i></a> callback function (if it exists).</li>
<li>The framework starts all of the device's power-managed I/O queues.</li>
<li>If the driver is using self-managed I/O, the framework calls the driver's <a href="wdf.evtdeviceselfmanagedioinit"><i>EvtDeviceSelfManagedIoInit</i></a> callback function.</li>
</ol>
</li>
</ul>
<p>For more information about the power-up sequence for KMDF function or filter drivers, <a href="power-up_sequence_for_a_function_or_filter_driver.htm">Power-Up Sequence for a Function or Filter Driver</a>.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20A User Plugs in a Device%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
