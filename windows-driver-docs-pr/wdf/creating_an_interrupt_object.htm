<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Creating an Interrupt Object"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Creating an Interrupt Object</title>

<meta name="MS-HAID" content="Ch8_DFTechniques_2edaf0b3-735d-4305-806e-c13e4cd312d1.xml"/>
<meta name="MS-HAID" content="kmdf.creating_an_interrupt_object"/>
<meta name="MS-HAID" content="wdf.creating_an_interrupt_object"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.creating_an_interrupt_object"></a>Creating an Interrupt Object</h1>
</div>
<p>A Windows Driver Frameworks (WDF) driver that handles a device's hardware interrupts must create a framework interrupt object for each interrupt that each device can support. In framework versions 1.11 and later running on Windows 8 or later versions of the operating system, Kernel-Mode Driver Framework (KMDF) and User-Mode Driver Framework (UMDF) drivers can  create interrupt objects requiring <a href="supporting_passive_level_interrupts.htm">passive-level handling</a>. Unless you are writing a driver for a System on a Chip (SoC) platform, however, your driver should use DIRQL interrupt objects.</p>
<p>A driver typically creates framework interrupt objects in its <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function. A driver can also create interrupt objects from its <a href="wdf.evtdevicepreparehardware"><i>EvtDevicePrepareHardware</i></a> callback function.</p>
<p>The framework calls the driver's <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function before the Plug and Play (PnP) manager has assigned system resources, such as interrupt vectors, to the device. After the PnP manager assigns resources, the framework stores interrupt resources in the device's interrupt object. (Drivers that <a href="using_kernel_mode_driver_framework_with_non_pnp_drivers.htm">do not support Plug and Play</a> cannot use interrupt objects.)</p>
<p> To create a framework interrupt object, your driver must initialize a <a href="wdf.wdf_interrupt_config"><b>WDF_INTERRUPT_CONFIG</b></a> structure and pass it to the <a href="wdf.wdfinterruptcreate"><b>WdfInterruptCreate</b></a> method.</p>
<p>UMDF
         supports the following types of interrupts:<ul>
<li>Level-triggered (shared or exclusive)</li>
<li>Edge-triggered (exclusive only)</li>
<li>MSI (exclusive by definition)</li>
</ul>
</p>
<div class="alert"><b>Note</b>  UMDF does not support <i>shared</i> edge-triggered interrupts.</div>
<div> </div>
<p>Starting in UMDF version 2.15, UMDF supports interrupts for simple devices like hardware push-buttons, usually backed by GPIO pins, that you cannot enable or disable explicitly using hardware registers.  To support such devices, a UMDF driver must use exclusive edge-triggered interrupts.</p>
<p> Starting in KMDF version 1.15, KMDF also supports interrupts for such devices, without the workaround described in <a href="handling_active-both_interrupts.htm">Handling Active-Both Interrupts</a>.</p>
<p>Also  in <a href="wdf.wdf_interrupt_config"><b>WDF_INTERRUPT_CONFIG</b></a>, your driver supplies pointers to the following driver-supplied event callback functions:</p>
<p></p>
<dl>
<dt><a id="_________EvtInterruptEnable________"></a><a id="_________evtinterruptenable________"></a><a id="_________EVTINTERRUPTENABLE________"></a><a href="wdf.evtinterruptenable"><i>
        EvtInterruptEnable
       </i></a></dt>
<dd>
<p>Enables a hardware interrupt.</p>
</dd>
<dt><a id="_________EvtInterruptDisable________"></a><a id="_________evtinterruptdisable________"></a><a id="_________EVTINTERRUPTDISABLE________"></a><a href="wdf.evtinterruptdisable"><i>
        EvtInterruptDisable
       </i></a></dt>
<dd>
<p>Disables a hardware interrupt.</p>
</dd>
<dt><a id="_________EvtInterruptIsr________"></a><a id="_________evtinterruptisr________"></a><a id="_________EVTINTERRUPTISR________"></a><a href="wdf.evtinterruptisr"><i>
        EvtInterruptIsr
       </i></a></dt>
<dd>
<p>Interrupt service routine (ISR) for the interrupt.</p>
</dd>
<dt><a id="_________EvtInterruptDpc________"></a><a id="_________evtinterruptdpc________"></a><a id="_________EVTINTERRUPTDPC________"></a><a href="wdf.evtinterruptdpc"><i>
        EvtInterruptDpc
       </i></a></dt>
<dd>
<p>Deferred procedure call (DPC) for the interrupt.</p>
</dd>
<dt><a id="EvtInterruptWorkItem"></a><a id="evtinterruptworkitem"></a><a id="EVTINTERRUPTWORKITEM"></a><a href="wdf.evtinterruptworkitem"><i>EvtInterruptWorkItem</i></a></dt>
<dd>
<p>Work item for a <a href="supporting_passive_level_interrupts.htm">passive-level interrupt</a>.</p>
</dd>
</dl>
<p>For drivers using framework version 1.11 or later on Windows 8 or later versions of the operating system, the driver can explicitly set the parent of a framework interrupt object (DIRQL or passive) to  either a framework device object or a framework queue object.    If the driver specifies a parent, the driver must set the <b>AutomaticSerialization</b> member of the interrupt object's <a href="wdf.wdf_interrupt_config"><b>WDF_INTERRUPT_CONFIG</b></a> structure to TRUE.  (Recall that if <b>AutomaticSerialization</b> is TRUE, the framework  synchronizes execution of the interrupt object's <a href="wdf.evtinterruptdpc"><i>EvtInterruptDpc</i></a> or <a href="wdf.evtinterruptworkitem"><i>EvtInterruptWorkItem</i></a> callback function with callback functions from other objects that are underneath the interrupt's parent object.)</p>
<p>As an example, a driver might specify a queue as parent of an interrupt to synchronize the queue's callbacks with either the interrupt's <a href="wdf.evtinterruptdpc"><i>EvtInterruptDpc</i></a> or <a href="wdf.evtinterruptworkitem"><i>EvtInterruptWorkItem</i></a> callback. In this configuration, the framework deletes the queue object when it deletes the device object.</p>
<p>After calling <a href="wdf.wdfinterruptcreate"><b>WdfInterruptCreate</b></a>, the driver can optionally call <a href="wdf.wdfinterruptsetpolicy"><b>WdfInterruptSetPolicy</b></a> or <a href="wdf.wdfinterruptsetextendedpolicy"><b>WdfInterruptSetExtendedPolicy</b></a> to specify additional interrupt parameters. Typically the driver calls these methods from its <a href="wdf.evtdriverdeviceadd"><i>EvtDriverDeviceAdd</i></a> callback function.</p>
<p>The framework automatically deletes the interrupt before deleting the interrupt's parent. Optionally, a driver can call <a href="wdf.wdfobjectdelete"><b>WdfObjectDelete</b></a> to delete the interrupt at an earlier time.</p>
<h2><a id="Supporting_Message-signaled_Interrupts"></a><a id="supporting_message-signaled_interrupts"></a><a id="SUPPORTING_MESSAGE-SIGNALED_INTERRUPTS"></a>Supporting Message-signaled Interrupts</h2>
<p>Message-signaled interrupts (MSIs) are supported starting with Windows Vista. To enable the operating system to support MSIs for your device, your driver's INF file must set some values in the registry. For information about how to set these values, see <a href="kernel.enabling_message_signaled_interrupts_in_the_registry">Enabling Message-Signaled Interrupts in the Registry</a>.</p>
<p>Your driver should create a framework interrupt object for each interrupt vector or MSI message that the device can support. If the PnP manager does not grant the device all of the interrupt resources that the device can support, the extra interrupt objects will not be used and their callback functions will not be called.</p>
<p>In Windows 7, the operating system does not support resource requests for more than 910 interrupt messages per device function. In Windows 8, the operating system does not support resource requests for more than 2048 interrupts per device function.</p>
<p> If the device driver exceeds this limit, the device might fail to start. To operate in a computer that contains many logical processors, the driver should not request more than one interrupt per processor.</p>
<p>A driver must tolerate, without failures, system rebalancing of interrupt resources in which the PnP manager assigns to the device any set of alternative interrupt resources from the resource requirements list. For example, the device might be assigned a smaller number of message interrupts than the driver requested. In the worst case, the driver must be prepared to operate the device with just one line-based interrupt.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Creating an Interrupt Object%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
