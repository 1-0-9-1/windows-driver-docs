<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="This topic describes how you can analyze why the reflector terminated the driver host process (WUDFHost.exe)."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Determining Why the Reflector Terminated the Host Process</title>

<meta name="MS-HAID" content="umdfobjectdg_51890205-e9be-45a0-a408-ed80fbb93644.xml"/>
<meta name="MS-HAID" content="umdf.determining_why_the_reflector_terminated_the_host_process"/>
<meta name="MS-HAID" content="wdf.determining_why_the_reflector_terminated_the_host_process"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="wdf.determining_why_the_reflector_terminated_the_host_process"></a>Determining Why the Reflector Terminated the Host Process</h1>
</div>
<p>This topic describes how you can analyze why the reflector terminated the driver host process (WUDFHost.exe).</p>
<p>The most common reason for the reflector to terminate the host process is the expiration of UMDF <a href="how_umdf_enforces_time_outs.htm">host process timeouts</a>.</p>
<h2><a id="post_mortem_analysis_using_dump_files"></a><a id="POST_MORTEM_ANALYSIS_USING_DUMP_FILES"></a>Using Dump Files</h2>
<p>For many crashes, dump file details are sufficient to determine why the termination occurred.  To review dump file information, follow these steps:</p>
<ol>
<li>
<p>Locate the latest .dmp file in the %windir%\system32\LogFiles\WUDF directory.</p>
<div class="alert"><b>Note</b>  Starting in UMDF 2.15, the log directory is <i>%ProgramData%</i>\Microsoft\WDF.</div>
<div> </div>
</li>
<li>Load the latest .dmp file into the debugger by using the following command: <div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>WinDbg -z &lt;path to the .dmp file&gt;</pre>
</td>
</tr>
</table></span></div>
</li>
<li>
<p>Look at the state of the threads at the time of termination.</p>
</li>
</ol>
<h2><a id="live_debugging"></a><a id="LIVE_DEBUGGING"></a>Using the Debugger</h2>
<p>In other cases, you might need to attach to a live kernel-mode target to determine why the reflector terminated the host process. To set up your debugging session, follow the steps described in <a href="enabling_a_debugger.htm#kd">How to Enable Debugging of a UMDF Driver</a>.</p>
<p>Once you have established a connection, display the outstanding IRPs by using the <a href="debugger._wdfkd_wdfumirps"><b>!wdfkd.wdfumirps</b></a> UMDF debugger extension (<a href="debugger._wudfext_umirps"><b>!wudfext.umirps</b></a> for UMDF version 1). </p>
<ul>
<li>
<p>If a PnP IRP or a power IRP is pending, determine why the driver causes the IRP to hang by examining threads in the host process. </p>
<p>You can use the <a href="debugger._process"><b>!process</b></a> extension to examine the threads running in the host process. The <b>0x1f</b> flags value shows you the stack trace for each thread.</p>
<p><b>!process </b><i>&lt;process addr&gt;</i><b> 0x1f</b></p>
</li>
<li>If your driver has not completed a canceled IRP quickly, determine which IRP was canceled and why it has not completed. </li>
<li>If a cleanup or close IRP is pending, determine why the IRP is taking a long time to process. </li>
</ul>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [wdf\wdf]:%20Determining Why the Reflector Terminated the Host Process%20 RELEASE:%20(3/15/2016)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
