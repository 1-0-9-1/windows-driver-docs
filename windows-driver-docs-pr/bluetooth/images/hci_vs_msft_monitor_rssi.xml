<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../BuildX/Script2/preview.xslt"?>
<refpage xmlns="http://microsoft.com/wdcml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://microsoft.com/wdcml ../../BuildX/Schema/xsd/wdcml.xsd">
 <metadata id="bltooth.hci_vs_msft_monitor_rssi" type="refpage" msdnID="B18FBE4F-08B3-4B0E-9733-BDB0F60494A0">
  <title>HCI_VS_MSFT_Monitor_Rssi</title>
  <devlang value="cpp"/>
  <tech value="bltooth"/>
  <index/>
  <seo nohighlight="1"/>
</metadata>
 <content>
  <desc>
   <p><abstract>HCI_VS_MSFT_Monitor_Rssi requests that the controller starts monitoring the measured link RSSI for a specified connection, and generates an event when the connection's measured link RSSI goes outside of the specified bounds.</abstract></p><table><tr><th>Command</th><th>Code</th><th>Command parameters</th><th>Return parameters</th></tr><tr><td><p>HCI_VS_MSFT_Monitor_Rssi</p></td><td><p>Chosen base  code </p></td><td><p><placeholder>Subcommand_opcode</placeholder></p><p><placeholder>Connection_handle</placeholder></p><p><placeholder>RSSI_threshold_high</placeholder></p><p><placeholder>RSSI_threshold_low</placeholder></p><p><placeholder>RSSI_threshold_low_time_interval</placeholder></p><p><placeholder>RSSI_sampling_period</placeholder></p></td><td><p><placeholder>Status</placeholder></p><p><placeholder>Subcommand_opcode</placeholder></p></td></tr></table><p>The controller shall notify the host of the RSSI value with a periodically generated event (based on the <placeholder>RSSI_sampling_period</placeholder>). The measured link RSSI shall be the <mark type="bullet_intro">absolute</mark> receiver signal strength value in dBm for the BR/EDR connection.</p><p>In response to a HCI_VS_MSFT_Monitor_Rssi command, the controller shall generate a Command Complete event with status equaling zero if the controller can begin monitoring, or a non-zero status otherwise. If the status value is non-zero, the controller shall not generate an <xref targtype="refpage" rid="bltooth.hci_vs_msft_rssi_event">HCI_VS_MSFT_Rssi_Event</xref> in response to this command.</p><p>The controller shall refuse the command if another HCI_VS_MSFT_Monitor_Rssi command with the same <placeholder>Connection_handle</placeholder> is outstanding, or if the specified connection handle is invalid. The controller may also refuse the command for other reasons, such as resource exhaustion.</p></desc>
  <section><title>State diagram</title><sectioncontents><p>This state diagram shows the transition states on the controller when monitoring RSSI for a connection.</p><img src="images/HCI_VS_MSFT_Monitor_Rssi_State_Diagram.png" alt="State diagram of HCI_VS_MSFT_Monitor_Rssi"/><p>The controller shall generate an HCI_VS_MSFT_Rssi_Event when the received RSSI is greater than or equal to the specified <placeholder>RSSI_threshold_high</placeholder>. After this event has been generated, the controller shall not generate a new HCI_VS_MSFT_Rssi_Event to specify that the <placeholder>RSSI_threshold_high</placeholder> has been exceeded until it generates an HCI_VS_MSFT_Rssi_Event that specifies the RSSI has fallen below <placeholder>RSSI_threshold_low</placeholder>.</p><p>The controller shall generate an HCI_VS_MSFT_Rssi_Event when the received RSSI equals or falls below the specified <placeholder>RSSI_threshold_low</placeholder> over the specified <placeholder>RSSI_threshold_low_time_interval</placeholder>. After this event has been generated, the controller shall not generate a new HCI_VS_MSFT_Rssi_Event to specify that the RSSI has fallen below the <placeholder>RSSI_threshold_low</placeholder> until an HCI_VS_MSFT_Rssi_Event event is generated to specify that <placeholder>RSSI_threshold_high</placeholder> has been reached or exceeded.</p><p>If the <placeholder>RSSI_sampling_period</placeholder> is between 0x01 and 0xFE, the controller shall generate an HCI_VS_MSFT_Rssi_Event periodically every <placeholder>RSSI_sampling_period</placeholder>. This event shall contain the average of the RSSI calculated over the <placeholder>RSSI_sampling_period</placeholder>.</p><p>If the <placeholder>RSSI_sampling_period</placeholder> is 0x00 or 0xFF, the controller shall <mark type="bullet_intro">not</mark> notify the host periodically with HCI_VS_MSFT_Rssi_Event.</p></sectioncontents></section><section><title>Command parameters</title><sectioncontents><list nobullets="1"><item><p><mark type="bullet_intro"><placeholder>Subcommand_opcode</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p>0x01</p></td><td><p>The subcommand opcode for HCI_VS_MSFT_Monitor_Rssi.</p></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>Connection_handle</placeholder></mark> (2 octets):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p>0x<mark type="param">XXXX</mark></p></td><td><p>The handle for the connection whose RSSI must be monitored.</p></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>RSSI_threshold_high</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p xml:space="default"><placeholder>N</placeholder> = <mark type="param">High<entity type="nbsp"/>RSSI threshold<entity type="nbsp"/>value</mark></p></td><td><p>The maximum expected RSSI value. The controller will generate an event if the observed RSSI becomes greater than or equal to this value.</p><p>For BR/EDR:</p><list><item>Range: -128 &lt;= <placeholder>N</placeholder> &lt;= 127 (signed integer)</item><item>Unit: dBm</item></list><p>For LE:</p><list><item>Range: -127 to 20 (signed integer)</item><item>Unit: dBm</item></list></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>RSSI_threshold_low</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p xml:space="default"><placeholder>N</placeholder> = <mark type="param">Low<entity type="nbsp"/>RSSI threshold<entity type="nbsp"/>value</mark></p></td><td><p>The minimum expected RSSI value. The controller will generate an event if the observed RSSI becomes less than or equal to this value.</p><p>For BR/EDR:</p><list><item>Range: -128 &lt;= <placeholder>N</placeholder> &lt;= 127 (signed integer)</item><item>Unit: dBm</item></list><p>For LE:</p><list><item>Range: -127 to 20 (signed integer)</item><item>Unit: dBm</item></list></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>RSSI_threshold_low_time_interval</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p>0x00</p></td><td><p>Reserved value.</p></td></tr><tr><td><p xml:space="preserve"><placeholder>N</placeholder><entity type="nbsp"/>=<entity type="nbsp"/>0x01<entity type="nbsp"/>-<entity type="nbsp"/>0x3C</p></td><td><p>Time period = <placeholder>N</placeholder> * 1 second</p><p>The time in seconds over which the RSSI value should be below <placeholder>RSSI_threshold_low</placeholder> before an <xref targtype="refpage" rid="bltooth.hci_vs_msft_rssi_event">HCI_VS_MSFT_Rssi_Event</xref> is generated.</p></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>RSSI_sampling_period</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p>0x00</p></td><td><p>Reserved value.</p></td></tr><tr><td><p xml:space="preserve"><placeholder>N</placeholder><entity type="nbsp"/>=<entity type="nbsp"/>0x01<entity type="nbsp"/>-<entity type="nbsp"/>0xFE</p></td><td><p>Time period = <placeholder>N</placeholder> * 100 milliseconds</p><p>The sampling interval in milliseconds.</p></td></tr><tr><td><p>0xFF</p></td><td><p>Reserved value.</p></td></tr></table></item></list></sectioncontents></section><section><title>Return parameters</title><sectioncontents><list nobullets="1"><item><p><mark type="bullet_intro"><placeholder>Status</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td><p>0x00</p></td><td><p>The command succeeded.</p></td></tr><tr><td><p>0x07</p></td><td><p>The controller shall return <placeholder>Memory Capacity Exceeded</placeholder> if it does not have enough memory to process the command.</p></td></tr><tr><td><p xml:space="preserve"><mark type="param">Error<entity type="nbsp"/>code</mark></p></td><td><p>The command failed. See <placeholder>Error Codes</placeholder> in the Bluetooth Core specification for details.</p></td></tr></table></item><item><p><mark type="bullet_intro"><placeholder>Subcommand_opcode</placeholder></mark> (1 octet):</p><table><tr><th>Value</th><th>Parameter description</th></tr><tr><td>0x01</td><td>The subcommand opcode for HCI_VS_MSFT_Monitor_Rssi.</td></tr></table></item></list></sectioncontents></section><section><title>Events generated (unless masked away)</title><sectioncontents><p>The controller shall promptly generate a Command Complete event when the HCI_VS_MSFT_Monitor_Rssi command is received. If the Command Complete event returns a status of  0, the controller shall generate an <xref targtype="refpage" rid="bltooth.hci_vs_msft_rssi_event">HCI_VS_MSFT_Rssi_Event</xref> when one of the following occurs.</p><list><item>The observed RSSI for the device over <placeholder>RSSI_threshold_low_time_interval</placeholder> becomes equal to or less than the specified <placeholder>RSSI_threshold_low</placeholder> value.</item><item>The observed RSSI for the device becomes greater than or equal to the specified <placeholder>RSSI_threshold_high</placeholder> value. </item><item>The <placeholder>RSSI_sampling_period</placeholder> is valid and the sampling period expires.</item></list><p>The controller should do all necessary cleanup if connectivity with the specified device is lost. In this case, an <xref targtype="refpage" rid="bltooth.hci_vs_msft_cancel_monitor_rssi">HCI_VS_MSFT_Cancel_Monitor_Rssi</xref> command is not sent to the controller.</p></sectioncontents></section><seealso><xref targtype="refpage" rid="bltooth.hci_vs_msft_rssi_event">HCI_VS_MSFT_Rssi_Event</xref><xref targtype="refpage" rid="bltooth.hci_vs_msft_cancel_monitor_rssi">HCI_VS_MSFT_Cancel_Monitor_Rssi</xref></seealso>
  <info><product rid="version">Supported in <tla rid="win_threshold_desktop" expansion="always"/>,  <tla rid="win_threshold_mobile" expansion="first_use_only"/>, and later versions.</product></info>
 </content>
  </refpage>
